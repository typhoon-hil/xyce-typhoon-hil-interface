//
// Saved by sw version: 2020.3
// Save timestamp: 06-Nov-2020 @ 09:39:16 AM
//

library "xyce_lib" {
    configuration {
        hil_device = "HIL402"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = auto
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
    }

    component Subsystem Root {

        component Subsystem XyceSim {
                layout = dynamic
                component "core/Current Measurement" not_used {
                }
                [
                    position = 8160, 8152
                    size = 64, 32
                ]

                component pas_resistor R1 {
                }
                [
                    position = 8248, 8152
                ]

                connect not_used.p_node R1.n_node as Connection1
                connect not_used.n_node R1.p_node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Perform the simulation using the Xyce solver.</p></body></html>"

                    sim_type {
                        label = "Analysis type"
                        widget = combo
                        combo_values = "Transient", "AC small-signal"
                        type = string
                        default_value = "Transient"
                        no_evaluate

                        CODE property_value_changed
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.update_display(mdl, container_handle)
                        ENDCODE

                        CODE property_value_edited
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.update_display(mdl, container_handle)
                        ENDCODE
                    }

                    start_f {
                        label = "Start frequency"
                        widget = edit
                        type = generic
                        default_value = "10"
                        nonvisible
                        no_evaluate
                    }

                    end_f {
                        label = "End frequency"
                        widget = edit
                        type = generic
                        default_value = "10000"
                        nonvisible
                        no_evaluate
                    }

                    num_points {
                        label = "Number of points"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    sim_time {
                        label = "Total time"
                        widget = edit
                        type = generic
                        default_value = "0.1ms"
                        no_evaluate
                    }

                    max_ts {
                        label = "Maximum simulation time-step"
                        widget = edit
                        type = generic
                        default_value = "1e-7"
                        no_evaluate
                    }

                    calculate_operation_point {
                        label = "Calculate DC operation point"
                        widget = checkbox
                        type = string
                        default_value = "True"
                    }

                    start_sim {
                        widget = button
                        type = string
                        default_value = "Start simulation"
                        no_evaluate

                        CODE button_clicked
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.start_sim(mdl, container_handle)
                        ENDCODE
                    }

                    sa_process_string {
                        widget = edit
                        type = string
                        default_value = ""
                        no_evaluate
                        nonvisible
                    }

                    open_sa {
                        widget = button
                        type = string
                        default_value = "Plot"
                        no_evaluate

                        CODE button_clicked
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.open_sa(mdl, container_handle)
                        ENDCODE
                    }

                    timeint_method {
                        label = "Integration method"
                        widget = combo
                        combo_values = "Trapezoidal", "Gear"
                        type = string
                        default_value = "Trapezoidal"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    voltage_limiting {
                        label = "Voltage limiting"
                        widget = checkbox
                        type = string
                        default_value = "True"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    timeint_abstol {
                        label = "Absolute error tolerance"
                        widget = edit
                        type = string
                        default_value = "1e-6"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    timeint_reltol {
                        label = "Relative error tolerance"
                        widget = edit
                        type = string
                        default_value = "1e-3"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    nonlinear_solver {
                        label = "Nonlinear solution strategy"
                        widget = combo
                        combo_values = "Newton", "Gradient", "Trust region"
                        type = string
                        default_value = "Newton"
                        group = "Advanced:2"
                        no_evaluate

                        CODE property_value_edited
                            maxstep_prop = mdl.prop(container_handle, "nonlinear_maxstep")
                            if new_value == "Newton":
                                mdl.show_property(maxstep_prop)
                            else:
                                mdl.hide_property(maxstep_prop)
                        ENDCODE

                        CODE property_value_changed
                            maxstep_prop = mdl.prop(container_handle, "nonlinear_maxstep")
                            if new_value == "Newton":
                                mdl.show_property(maxstep_prop)
                            else:
                                mdl.hide_property(maxstep_prop)
                        ENDCODE
                    }

                    nonlinear_maxstep {
                        label = "Maximum Newton steps"
                        widget = edit
                        type = string
                        default_value = "20"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    nonlinear_abstol {
                        label = "Absolute residual vector tolerance"
                        widget = edit
                        type = string
                        default_value = "1e-6"
                        group = "Advanced:2"
                        no_evaluate
                    }

                    nonlinear_reltol {
                        label = "Relative residual vector tolerance"
                        widget = edit
                        type = string
                        default_value = "1e-2"
                        group = "Advanced:2"
                        no_evaluate
                    }


                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        from PyQt5 import QtWidgets, QtCore
                        import os

                        start_sim_prop = mdl.prop(item_handle, "start_sim")
                        if mdl.get_model_file_path() == "":
                            mdl.info("Please save your file to enable the simulation button.")
                            mdl.disable_property(start_sim_prop)
                        else:
                            mdl.enable_property(start_sim_prop)

                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        buttons = dialog.findChildren(QtWidgets.QPushButton)
                        for button in buttons:
                          if button.text() == "OK":
                            mdl.set_ns_var("ok_button_handle", button)
                            break
                        dialog.exec()

                    ENDCODE

                    CODE init
                        import importlib
                        import xyce_thcc_lib.component_scripts.comp_xycesim as comp_script
                        importlib.reload(comp_script)

                        def return_comp_script(mdl, item_handle):
                            return comp_script

                        comp_script.update_display(mdl, item_handle)
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/xyce_logo.png')
                    ENDCODE

                    CODE pre_compile
                    ENDCODE

                    CODE post_resolve
                    ENDCODE
                }
            }
            [
                position = 7952, 8176
                size = 112, 56
            ]

        component Category Switches {
            layout = dynamic
            component Subsystem "Current-Controlled Switch" {
                layout = static
                label = "CCSW"
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                port n_node {
                    label = "-"
                    position = right center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                port p_node {
                    label = "+"
                    position = left center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                connect p_node "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" n_node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Current-Controlled Switch</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">In Xyce, this is an \"W\" type component.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">With an Active-High logic selected, the switch remains closed (is modeled as an R_on resistor) if the current on the selected controlling measurement is positive. When open, the switch is modeled as an R_off resistor.</p></body></html>"

                    r_on {
                        label = "ON Resistance"
                        widget = edit
                        type = generic
                        default_value = "1e-3"
                    }

                    r_off {
                        label = "OFF Resistance"
                        widget = edit
                        type = generic
                        default_value = "1e6"
                    }

                    logic {
                        label = "Logic"
                        widget = combo
                        combo_values = "Active High", "Active Low"
                        type = string
                        default_value = "Active High"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    ctrl_name {
                        label = "Controlling measurement name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    update_currents {
                        label = "Update current measurements"
                        widget = button
                        type = string
                        default_value = "Update"
                        no_evaluate

                        CODE button_clicked
                            update_current_measurements(mdl, container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/cc_switch_high.svg')
                        ctrl_name_prop = mdl.prop(item_handle, "ctrl_name")
                        ctrl_name = mdl.get_property_value(ctrl_name_prop)
                    
                        try:
                    
                            logic = mdl.prop(item_handle, "logic")
                    
                            if mdl.get_property_value(logic) == "Active Low":
                                if not ctrl_name == "None":
                                    mdl.set_component_icon_image(item_handle, 'images/cc_switch_low_selectedcur.svg')
                                    mdl.set_color(item_handle, "blue")
                                    mdl.disp_component_icon_text(item_handle, " " + ctrl_name, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                                else:
                                    mdl.set_component_icon_image(item_handle, 'images/cc_switch_low.svg')
                            else:
                                if not ctrl_name == "None":
                                   mdl.set_component_icon_image(item_handle, 'images/cc_switch_high_selectedcur.svg')
                                   mdl.set_color(item_handle, "blue")
                                   mdl.disp_component_icon_text(item_handle, " " + ctrl_name, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                    
                        except: pass
                    ENDCODE

                    CODE init
                        # Return all components (including inside subsystems)
                        def all_circuit_components(model, parent_comp=None):
                            component_list = []
                            if parent_comp:  # Component inside a subsystem (recursive function)
                                all_components = model.get_items(parent_comp)
                            else:  # Top level call
                                all_components = model.get_items()

                            for comp in all_components:
                                try:
                                    type_name = model.get_component_type_name(comp)
                                    if type_name:
                                        component_list.append(comp)
                                    else:  # Component is a subsystem
                                        component_list.extend(all_circuit_components(model, comp))
                                except:
                                    # Some components (such as ports and connections) cannot be used with
                                    # get_component_type_name
                                    pass
                            # Return the list of component handles
                            return component_list

                        def update_current_measurements(mdl, item_handle):
                            i_list = []
                    
                            for item in all_circuit_components(mdl):
                                try: # Not every component has a type
                                    if mdl.get_component_type_name(item) == "Current Measurement":
                                        i_list.append(item.fqn)
                                except AttributeError: pass
                    
                            for item in all_circuit_components(mdl):
                                try: # Not every component has a type
                                    if mdl.get_component_type_name(item) == "Current-Controlled Switch":
                                        ctrl_name_prop = mdl.prop(item, "ctrl_name")
                                        mdl.set_property_combo_values(ctrl_name_prop, i_list)
                                        displayed_ctrl = mdl.get_property_disp_value(ctrl_name_prop)
                                        if displayed_ctrl not in i_list:
                                            mdl.set_property_value(ctrl_name_prop, "None")
                                            mdl.refresh_icon(item)
                                except AttributeError: pass
                    
                        update_current_measurements(mdl, item_handle)
                    ENDCODE
                }
            }
            [
                position = 7616, 7944
                size = 64, 64
            ]

            component Subsystem "Voltage-Controlled Switch" {
                layout = static
                label = "VCSW"
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7904, 7992
                ]

                port p_node {
                    label = "+"
                    position = left center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port n_node {
                    label = "-"
                    position = right center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                port p_ctrl {
                    label = "Ctrl+"
                    position = 0.0, -26.0
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port n_ctrl {
                    label = "Ctrl-"
                    position = -20.0, -26.0
                    kind = pe
                }
                [
                    position = 8040, 7992
                    hide_name = True
                    scale = -1, 1
                ]

                connect p_node "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" n_node as Connection2
                connect p_ctrl "Short Circuit1.p_node" as Connection3
                connect "Short Circuit1.n_node" n_ctrl as Connection4

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Voltage-Controlled Switch</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">In Xyce, this is an \"S\" type component.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">With an Active-High logic selected, the switch remains closed (is modeled as an R_on resistor) while a positive differential voltage is measured between the + and - terminals. When open, the switch is modeled as an R_off resistor.</p></body></html>"

                    r_on {
                        label = "ON Resistance"
                        widget = edit
                        type = generic
                        default_value = "1e-3"
                    }

                    r_off {
                        label = "OFF Resistance"
                        widget = edit
                        type = generic
                        default_value = "1e6"
                    }

                    logic {
                        label = "Logic"
                        widget = combo
                        combo_values = "Active High", "Active Low"
                        type = string
                        default_value = "Active High"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_p {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/vc_switch_high.svg')
                    
                        try:
                            logic = mdl.prop(item_handle, "logic")
                    
                            if mdl.get_property_value(logic) == "Active Low":
                                mdl.set_component_icon_image(item_handle, 'images/vc_switch_low.svg')
                        except: pass
                    ENDCODE
                }
            }
            [
                position = 7440, 7944
                size = 64, 64
            ]

            component Subsystem MESFET {
                layout = static
                label = "S"
                component el_short "Short Circuit 2" {
                }
                [
                    position = 7888, 7992
                ]

                component el_short "Short Circuit" {
                }
                [
                    position = 7888, 8064
                ]

                port src {
                    label = "S"
                    position = right center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port gate {
                    label = "G"
                    position = top center
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port drain {
                    label = "D"
                    position = left center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7952, 8064
                ]

                connect "Short Circuit.n_node" Junction1 as Connection3
                connect src "Short Circuit.p_node" as Connection1
                connect "Short Circuit 2.n_node" Junction1 as Connection6
                connect gate "Short Circuit 2.p_node" as Connection5
                connect Junction1 drain as Connection4

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Metal-Semiconductor Field Effect Transistor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"Z\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models found in the file may be added to the list. Please note that in this case ANY kind of subcircuit model will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_g {
                        label = "Gate voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 3-pin MESFETs
                                num_pins = 3
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([ A-z0-9_]+)\s+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                nmf_models = re.compile(r"^\.MODEL ([\S]*)\s+NMF", flags = re.I)
                                pmf_models = re.compile(r"^\.MODEL ([\S]*)\s+PMF", flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)
                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            nmf_match = re.match(nmf_models, line)
                                            if nmf_match:
                                                model_name = nmf_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                pmf_match = re.match(pmf_models, line)
                                                if pmf_match:
                                                    model_name = pmf_match.group(1)
                                                    model_list.append(model_name)
                                                else:
                                                    sub_match = re.match(sub_based, line)
                                                    if sub_match:
                                                        if len(sub_match.group(2).split()) == num_pins:
                                                            model_name = sub_match.group(1)
                                                            subcircuit_model_list.append(model_name)
                                                        in_sub_flag  = True
                                        else:
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/mesfet_nchannel.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.65, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.65, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7680, 8168
                rotation = right
                size = 64, 64
            ]

            component Subsystem BJT {
                layout = static
                label = "S"
                component el_short "Short Circuit 2" {
                }
                [
                    position = 7888, 7992
                ]

                component el_short "Short Circuit" {
                }
                [
                    position = 7888, 8064
                ]

                port col {
                    label = "C"
                    position = right center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port base {
                    label = "B"
                    position = top center
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port emit {
                    label = "E"
                    position = left center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7952, 8064
                ]

                connect "Short Circuit.n_node" Junction1 as Connection3
                connect col "Short Circuit.p_node" as Connection1
                connect "Short Circuit 2.n_node" Junction1 as Connection6
                connect base "Short Circuit 2.p_node" as Connection5
                connect Junction1 emit as Connection4

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Bipolar Junction Transistor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"Q\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models may be added to the list. Please note that in this case any type of subcircuit found in the file will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_g {
                        label = "Gate voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 3-pin BJTs (No temperature terminals)
                                num_pins = 3
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([\sA-z0-9_]+)[\s]+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                npn_models = re.compile(r"^\.MODEL ([\S]*)\s+NPN", flags = re.I)
                                pnp_models = re.compile(r"^\.MODEL ([\S]*)\s+PNP", flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)

                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            npn_match = re.match(npn_models, line)
                                            if npn_match:
                                                model_name = npn_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                pnp_match = re.match(pnp_models, line)
                                                if pnp_match:
                                                    model_name = pnp_match.group(1)
                                                    model_list.append(model_name)
                                                else:
                                                    sub_match = re.match(sub_based, line)
                                                    if sub_match:
                                                        if len(sub_match.group(2).split()) == num_pins:
                                                            model_name = sub_match.group(1)
                                                            subcircuit_model_list.append(model_name)
                                                        in_sub_flag  = True
                                        else:
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/bjt_npn.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.85, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.85, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7800, 8168
                rotation = right
                size = 64, 64
            ]

            component Subsystem JFET {
                layout = static
                label = "S"
                component el_short "Short Circuit 2" {
                }
                [
                    position = 7888, 7992
                ]

                component el_short "Short Circuit" {
                }
                [
                    position = 7888, 8064
                ]

                port src {
                    label = "S"
                    position = right center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port gate {
                    label = "G"
                    position = top center
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port drain {
                    label = "D"
                    position = left center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7952, 8064
                ]

                connect "Short Circuit.n_node" Junction1 as Connection3
                connect src "Short Circuit.p_node" as Connection1
                connect "Short Circuit 2.n_node" Junction1 as Connection6
                connect gate "Short Circuit 2.p_node" as Connection5
                connect Junction1 drain as Connection4

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Junction Field Effect Transistor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"J\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models may be added to the list. Please note that in this case any type of subcircuit found in the file will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_g {
                        label = "Gate voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 3-pin JFETs
                                num_pins = 3
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([ A-z0-9_]+)\s+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                njf_models = re.compile(r"^\.MODEL ([\S]*)\s+NJF",flags = re.I)
                                pjf_models = re.compile(r"^\.MODEL ([\S]*)\s+PJF",flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)

                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            njf_match = re.match(njf_models, line)
                                            if njf_match:
                                                model_name = njf_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                pjf_match = re.match(pjf_models, line)
                                                if pjf_match:
                                                    model_name = pjf_match.group(1)
                                                    model_list.append(model_name)
                                                else:
                                                    sub_match = re.match(sub_based, line)
                                                    if sub_match:
                                                        if len(sub_match.group(2).split()) == num_pins:
                                                            model_name = sub_match.group(1)
                                                            subcircuit_model_list.append(model_name)
                                                        in_sub_flag  = True
                                        else:
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/jfet_nchannel.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.65, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.65, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7552, 8168
                rotation = right
                size = 64, 64
            ]

            component Subsystem MOSFET {
                layout = static
                label = "S"
                component el_short "Short Circuit" {
                }
                [
                    position = 7888, 8064
                ]

                component el_short "Short Circuit 2" {
                }
                [
                    position = 7888, 7992
                ]

                port gate {
                    label = "G"
                    position = top center
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port src {
                    label = "S"
                    position = right center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port drain {
                    label = "D"
                    position = left center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7952, 8064
                ]

                connect src "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" Junction1 as Connection3
                connect Junction1 drain as Connection4
                connect gate "Short Circuit 2.p_node" as Connection5
                connect "Short Circuit 2.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Metal-Oxide-Semiconductor Field Effect Transistor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"M\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models may be added to the list. Please note that in this case any type of subcircuit found in the file will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_g {
                        label = "Gate voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                    
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 3-pin MOSFETs (No temperature terminals)
                                num_pins = 3
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([ A-z0-9_]+)\s+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                nmos_models = re.compile(r"^\.MODEL ([\S]*)\s+NMOS",flags = re.I)
                                pmos_models = re.compile(r"^\.MODEL ([\S]*)\s+PMOS",flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)
                    
                                # Models should not be added if inside a subcircuit definition
                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            nmos_match = re.match(nmos_models, line)
                                            if nmos_match:
                                                model_name = nmos_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                pmos_match = re.match(pmos_models, line)
                                                if pmos_match:
                                                    model_name = pmos_match.group(1)
                                                    model_list.append(model_name)
                                                else:
                                                    sub_match = re.match(sub_based, line)
                                                    if sub_match:
                                                        if len(sub_match.group(2).split()) == num_pins:
                                                            model_name = sub_match.group(1)
                                                            subcircuit_model_list.append(model_name)
                                                        in_sub_flag  = True
                                        else:
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/mosfet_nmos.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.9, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.9, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7432, 8168
                rotation = right
                size = 64, 64
            ]

            component Subsystem Diode {
                layout = static
                label = "D"
                component el_short "Short Circuit" {
                }
                [
                    position = 7880, 8040
                    rotation = down
                ]

                port p_node {
                    label = "+"
                    position = right center
                    kind = pe
                }
                [
                    position = 8000, 8040
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    label = "-"
                    position = left center
                    kind = pe
                }
                [
                    position = 7776, 8040
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" n_node as Connection2
                connect p_node "Short Circuit.p_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Diode</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"D\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models may be added to the list. Please note that in this case any type of subcircuit found in the file will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 2-pin diodes
                                num_pins = 2
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([ A-z0-9_]+)\s+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                diode_models = re.compile(r"^\.MODEL ([.\S]*)\s+(?:D|d)", flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)
                    
                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            diode_match = re.match(diode_models, line)
                                            if diode_match:
                                                model_name = diode_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                sub_match = re.match(sub_based, line)
                                                if sub_match:
                                                    if len(sub_match.group(2).split()) == num_pins:
                                                        model_name = sub_match.group(1)
                                                        subcircuit_model_list.append(model_name)
                                                    in_sub_flag  = True
                                        else:
                                            # Detect end of the subcircuit and update flag
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/diode.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                 mdl.set_color(item_handle, "blue")
                                 mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.2, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.2, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7432, 8064
                rotation = right
                size = 64, 64
            ]

            component Subsystem "Ideal Diode" {
                layout = static
                label = "D"
                component el_short "Short Circuit" {
                }
                [
                    position = 7880, 8040
                    rotation = down
                ]

                port p_node {
                    label = "+"
                    position = right center
                    kind = pe
                }
                [
                    position = 8000, 8040
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    label = "-"
                    position = left center
                    kind = pe
                }
                [
                    position = 7776, 8040
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" n_node as Connection2
                connect p_node "Short Circuit.p_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Ideal Diode.</p></body></html>"

                    r_on {
                        label = "Conduction resistance"
                        widget = edit
                        type = generic
                        default_value = "1e-4"
                        unit = "Ω"
                    }

                    vd_on {
                        label = "Forward voltage drop"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/diode.svg')
                    ENDCODE

                    CODE pre_compile
                    ENDCODE
                }
            }
            [
                position = 7048, 8000
                rotation = right
                size = 64, 64
            ]

            component Subsystem "Unidirectional Switch" {
                layout = static
                label = "S"
                component el_short "Short Circuit" {
                }
                [
                    position = 7888, 8064
                ]

                component el_short "Short Circuit 2" {
                }
                [
                    position = 7888, 7992
                ]

                port gate {
                    label = "G"
                    position = top center
                    kind = pe
                }
                [
                    position = 7768, 7992
                    hide_name = True
                ]

                port src {
                    label = "S"
                    position = right center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port drain {
                    label = "D"
                    position = left center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7952, 8064
                ]

                connect src "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" Junction1 as Connection3
                connect Junction1 drain as Connection4
                connect gate "Short Circuit 2.p_node" as Connection5
                connect "Short Circuit 2.n_node" Junction1 as Connection6

                r_on = "1e-4"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Unidirectional Switch Model.</p></body></html>"

                    r_on {
                        label = "Conduction resistance"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "Ω"
                    }

                    vd_on {
                        label = "Diode voltage drop"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                    }

                    vsw_on {
                        label = "Switch voltage drop"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_g {
                        label = "Gate voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/mosfet_nmos.svg')
                    ENDCODE

                    CODE pre_compile
                    ENDCODE
                }
            }
            [
                position = 7048, 8120
                rotation = right
                size = 64, 64
            ]
        }
        [
            position = 8320, 8016
            size = 96, 96
        ]

        component Category "Passive Elements" {
            layout = dynamic
            component Subsystem "Ideal Inductor" {
                layout = static
                label = "L"
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 8088
                    rotation = down
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 8048, 8088
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 7800, 8088
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.p_node" p_node as Connection2
                connect n_node "Short Circuit.n_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Ideal Inductor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"L\" type element with only the IC parameter.</p></body></html>"

                    L {
                        label = "Inductance"
                        widget = edit
                        type = generic
                        default_value = "10e-6"
                        unit = "H"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE

                        CODE property_value_edited
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    IC {
                        label = "Initial Current"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "A"
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/inductor.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        L_prop = mdl.prop(item_handle, "L")
                    
                        L_text, color = get_text(L_prop, "H")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color)
                            mdl.disp_component_icon_text(item_handle, L_text, relpos_y = 0.2, size = 8)
                    ENDCODE

                    CODE post_resolve
                        # HEADER START
                        L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                        IC = mdl.get_property_value(mdl.prop(item_handle, "IC"))
                        # HEADER STOP
                        mdl.refresh_icon(item_handle)
                    ENDCODE
                }
            }
            [
                position = 7784, 7904
                rotation = down
                scale = -1, -1
                size = 64, 64
            ]

            component Subsystem "Ideal Resistor" {
                layout = static
                label = "R"
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                    rotation = down
                ]

                port p_node {
                    label = "+"
                    position = left center
                    kind = pe
                }
                [
                    position = 8008, 8064
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    label = "-"
                    position = right center
                    kind = pe
                }
                [
                    position = 7800, 8064
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.p_node" p_node as Connection2
                connect n_node "Short Circuit.n_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Ideal Resistor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"R\" type element.</p></body></html>"

                    R {
                        label = "Resistance"
                        widget = edit
                        type = generic
                        default_value = "100"
                        unit = "Ω"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE

                        CODE property_value_edited
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/resistor.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        R_prop = mdl.prop(item_handle, "R")
                        R_text, color = get_text(R_prop, "Ω")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color)
                            mdl.disp_component_icon_text(item_handle, R_text, relpos_y = 0.2, size = 8)
                    ENDCODE

                    CODE post_resolve
                        # HEADER START
                        R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                        # HEADER STOP
                        mdl.refresh_icon(item_handle)
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7880, 7904
                rotation = down
                scale = -1, -1
                size = 64, 64
            ]

            component Subsystem Memristor {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7864, 8096
                    rotation = down
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 7984, 8096
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 7728, 8096
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect p_node "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" n_node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Memristor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"ymemristor\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A SPICE library file must be loaded and then the desired model selected from the Model Name list.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Subcircuit-based models may be added to the list. Please note that in this case any type of subcircuit found in the file will be added.</p></body></html>"

                    subc_model {
                        label = "Subcircuit-based models"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_edited
                            filename = mdl.get_property_value(mdl.prop(container_handle, "model_path"))
                            if not filename == "-":
                                repeat_parse(mdl, container_handle)
                        ENDCODE
                    }

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = edit
                        type = generic
                        default_value = "-"
                        no_evaluate
                        nonvisible
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 2-pin memristors
                                num_pins = 2
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([\sA-z0-9]+)[\s]+(?:PARAMS)?",
                                                        flags = re.I)
                                # Find individual models
                                memr_models = re.compile(r"^\.MODEL ([.\S]*)\s+MEMRISTOR",
                                                        flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)

                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            memr_match = re.match(memr_models, line)
                                            if memr_match:
                                                model_name = memr_match.group(1)
                                                model_list.append(model_name)
                                            else:
                                                sub_match = re.match(sub_based, line)
                                                if sub_match:
                                                    if len(sub_match.group(2).split()) == num_pins:
                                                        model_name = sub_match.group(1)
                                                        subcircuit_model_list.append(model_name)
                                                    in_sub_flag  = True
                                        else:
                                            # Detect end of the subcircuit and update flag
                                            if re.match(r".ENDS", line):
                                                in_sub_flag = False
                    
                                    if mdl.get_property_disp_value(mdl.prop(item_handle, "subc_model")) == True:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    else:
                                        mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        import builtins
                    
                        mdl.set_component_icon_image(item_handle, 'images/memristor.svg')
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                    
                        try:
                            builtins.open(model_path)
                            if not model_name == "None":
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.80, size = 8)
                        except:
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.80, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        subc_model = mdl.get_property_value(mdl.prop(item_handle, "subc_model"))
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7688, 8008
                size = 64, 64
            ]

            component Subsystem "Ideal Capacitor" {
                layout = static
                label = "C"
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                    rotation = down
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 8024, 8064
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 7792, 8064
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect n_node "Short Circuit.n_node" as Connection1
                connect "Short Circuit.p_node" p_node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Ideal Capacitor</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"C\" type element with only the IC parameter.</p></body></html>"

                    C {
                        label = "Capacitance"
                        widget = edit
                        type = generic
                        default_value = "100e-6"
                        unit = "F"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE

                        CODE property_value_edited
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    IC {
                        label = "Initial Voltage"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/capacitor.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        C_prop = mdl.prop(item_handle, "C")
                    
                        C_text, color = get_text(C_prop, "F")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color)
                            mdl.disp_component_icon_text(item_handle, C_text, relpos_y = 0.12, size = 8)
                    ENDCODE

                    CODE pre_compile
                    ENDCODE

                    CODE post_resolve
                        # HEADER START
                        C = mdl.get_property_value(mdl.prop(item_handle, "C"))
                        IC = mdl.get_property_value(mdl.prop(item_handle, "IC"))
                        # HEADER STOP
                        mdl.refresh_icon(item_handle)
                    ENDCODE
                }
            }
            [
                position = 7688, 7904
                rotation = down
                scale = -1, -1
                size = 64, 64
            ]

            component Subsystem Transformer {
                layout = static
                component el_open "Open Circuit1" {
                    circuit_connector = "true"
                }
                [
                    position = 8040, 8200
                ]

                component el_open "Open Circuit2" {
                    circuit_connector = "true"
                }
                [
                    position = 8040, 8296
                ]

                port prm_1 {
                    label = "prm_1"
                    position = left top
                    kind = pe
                }
                [
                    position = 7952, 8200
                ]

                port prm_2 {
                    label = "prm_2"
                    position = left bottom
                    kind = pe
                }
                [
                    position = 7952, 8296
                ]

                port sec_2 {
                    label = "sec_2"
                    position = right bottom
                    kind = pe
                }
                [
                    position = 8128, 8296
                    scale = -1, 1
                ]

                port sec_1 {
                    label = "sec_1"
                    position = right top
                    kind = pe
                }
                [
                    position = 8128, 8200
                    scale = -1, 1
                ]

                connect prm_1 "Open Circuit1.p_node" as Connection1
                connect "Open Circuit1.n_node" sec_1 as Connection2
                connect "Open Circuit2.n_node" sec_2 as Connection3
                connect prm_2 "Open Circuit2.p_node" as Connection4

                mask {
                    icon = "image(\'trl_2w1ph.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Two-winding transformer.</p></body></html>"
                    help_file = "single_phase_two_winding_transformer.html"

                    n1 {
                        label = "Primary turns (N1)"
                        widget = edit
                        type = generic
                        default_value = "1"
                    }

                    n2 {
                        label = "Secondary turns (N2)"
                        widget = edit
                        type = generic
                        default_value = "1"
                    }

                    meas_v {
                        label = "Voltages"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Currents"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    CODE init
                    ENDCODE

                    CODE pre_compile
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        image('trl_2w1ph.svg')
                    ENDCODE
                }
            }
            [
                position = 7472, 7960
                size = 124, 256
            ]

            component Subsystem "Coupled Inductor" {
                layout = static
                label = "Coupled"
                component el_short "Short Circuit" {
                }
                [
                    position = 7896, 8064
                    rotation = down
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 7776, 8064
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 8000, 8064
                    rotation = down
                    hide_name = True
                ]

                connect n_node "Short Circuit.n_node" as Connection1
                connect "Short Circuit.p_node" p_node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Coupled Inductor</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">In Xyce, this is a \"K\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This component identifies other Coupled Inductor components in the same schematic level.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">You can couple this inductor to another by selecting it on \"New Coupling\", specifying a mutual inductance value and then clicking on \"Add coupling\".</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">If this inductor is already coupled to others, you can select one on \"Coupled to\" and update the mutual inductance value or remove the coupling.</p></body></html>"

                    L {
                        label = "Self Inductance"
                        widget = edit
                        type = generic
                        default_value = "1e-04"
                        unit = "H"
                    }

                    IC {
                        label = "Initial Current"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "A"
                    }

                    create_coupling {
                        label = "New coupling"
                        widget = combo
                        combo_values = "No inductors available"
                        type = string
                        default_value = "No inductors available"
                        no_evaluate
                    }

                    coupling_coefficient {
                        label = "Coupling coefficient"
                        widget = edit
                        type = generic
                        default_value = "1"
                    }

                    add {
                        widget = button
                        type = string
                        default_value = "Add coupling"
                        no_evaluate

                        CODE button_clicked
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.add_coupling(mdl, container_handle)
                        ENDCODE
                    }

                    select_coupled {
                        label = "Coupled to"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.selected_a_coupled_inductor(mdl, container_handle)
                        ENDCODE
                    }

                    current_coupling_coefficient {
                        label = "Current coupling coefficient"
                        widget = edit
                        type = generic
                        default_value = "0"

                        CODE property_value_edited
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.edited_current_coupling_box_value(mdl, container_handle, new_value)
                        ENDCODE
                    }

                    change {
                        widget = button
                        type = string
                        default_value = "Save new value"
                        no_evaluate

                        CODE button_clicked
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.change_coupling_value(mdl, container_handle)
                        ENDCODE
                    }

                    remove {
                        widget = button
                        type = string
                        default_value = "Remove coupling"
                        no_evaluate

                        CODE button_clicked
                            comp_script = return_comp_script(mdl, container_handle)
                            comp_script.remove_coupling(mdl, container_handle)
                        ENDCODE
                    }

                    meas_v {
                        label = "Voltage"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_i {
                        label = "Current"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    meas_p {
                        label = "Power"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Measurements"
                        no_evaluate
                    }

                    inductors_dict {
                        label = "Dictionary of Coupled Inductors in this level"
                        widget = combo
                        combo_values = "{}"
                        type = string
                        default_value = "{}"
                        nonvisible
                        no_evaluate
                    }

                    couplings_dict {
                        label = "Existing couplings"
                        widget = combo
                        combo_values = "{}"
                        type = string
                        default_value = "{}"
                        nonvisible
                        no_evaluate
                    }

                    xyce_couplings_dict {
                        label = "Dictionary used by the Xyce converter"
                        widget = combo
                        combo_values = "{}"
                        type = string
                        default_value = "{}"
                        nonvisible
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        comp_script = return_comp_script(mdl, item_handle)
                        comp_script.update_all_inductors(mdl, item_handle)
                        comp_script.update_display(mdl, item_handle)
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        import importlib
                        import xyce_thcc_lib.component_scripts.comp_coupled_inductor as comp_script
                        importlib.reload(comp_script)

                        def return_comp_script(mdl, item_handle):
                            return comp_script
                    ENDCODE

                    CODE pre_compile
                        comp_script = return_comp_script(mdl, item_handle)
                        comp_script.pre_compile(mdl, item_handle)
                    ENDCODE

                    CODE define_icon
                        import ast
                    
                        couplings_dict_prop = mdl.prop(item_handle, "couplings_dict")
                        couplings_dict = ast.literal_eval(mdl.get_property_value(couplings_dict_prop))
                    
                        this_ind = mdl.get_parent(item_handle)
                        if couplings_dict.values():
                            for coupled_dict in list(couplings_dict.values()):
                                if coupled_dict.get(this_ind.item_fqid):
                                    mdl.set_component_icon_image(item_handle, 'images/coupled_inductor.svg')
                                    break
                                else:
                                    mdl.set_component_icon_image(item_handle, 'images/not_coupled_inductor.svg')
                        else:
                            mdl.set_component_icon_image(item_handle, 'images/not_coupled_inductor.svg')
                    
                    ENDCODE

                    CODE post_resolve
                    ENDCODE
                }
            }
            [
                position = 7880, 8008
                size = 64, 64
            ]
        }
        [
            position = 8096, 8016
            size = 96, 96
        ]

        component Category Sources {
            layout = dynamic
            component Category "Independent Sources" {
                layout = dynamic
                component Category Voltage {
                    layout = dynamic
                    component Subsystem "Exponent Voltage Source" {
                        layout = static
                        label = "Vexp"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 7976
                            rotation = right
                            hide_name = True
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 8152
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        connect Vs1.p_node p_node as Connection1
                        connect Vs1.n_node n_node as Connection2

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Exponent Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"V\" type element with a \"EXP\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output starts at the V1 voltage. At TD1 seconds, it rises exponentially to V2 according to TAU1. At TD2 seconds, it falls exponentially towards V1 according to TAU2.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The following equations describe the waveform:<br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">0 </p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">V(t) = V1 </p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">TD1 </p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">V(t) = V1 + (V2-V1)(1-exp(-(t-TD1)/TAU1))     [Eq1]</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">t > TD2:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">V(t) = Eq1 + (V1-V2)(1-exp(-(t-TD2)/TAU2))</p></body></html>"

                            V1 {
                                label = "Initial amplitude"
                                widget = edit
                                type = generic
                                default_value = "-50"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            V2 {
                                label = "Final amplitude"
                                widget = edit
                                type = generic
                                default_value = "50"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD1 {
                                label = "Rise delay time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TAU1 {
                                label = "Rise time constant"
                                widget = edit
                                type = generic
                                default_value = "0.005"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            TD2 {
                                label = "Fall delay time"
                                widget = edit
                                type = generic
                                default_value = "0.025"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TAU2 {
                                label = "Fall time constant"
                                widget = edit
                                type = generic
                                default_value = "0.01"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/vs_exp.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                TD1_prop = mdl.prop(item_handle, "TD1")
                                get_text(TD1_prop, "s")
                                TAU1_prop = mdl.prop(item_handle, "TAU1")
                                get_text(TAU1_prop, "s")
                                TD2_prop = mdl.prop(item_handle, "TD2")
                                get_text(TD2_prop, "s")
                                TAU2_prop = mdl.prop(item_handle, "TAU2")
                                get_text(TAU2_prop, "s")
                            
                                ignore = False
                                V1_prop = mdl.prop(item_handle, "V1")
                                V1_text, color = get_text(V1_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V1_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                V2_prop = mdl.prop(item_handle, "V2")
                                V2_text, color = get_text(V2_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V2_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7688, 8216
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "Pulse Voltage Source" {
                        layout = static
                        label = "Vpulse"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7920, 8032
                            rotation = right
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7920, 8120
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7920, 7952
                            rotation = right
                            hide_name = True
                        ]

                        connect Vs1.n_node n_node as Connection2
                        connect Vs1.p_node p_node as Connection1

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Pulse Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"V\" type element with a \"PULSE\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The source output starts at the value defined by V1 and immediately rises to V2 according to TR. After PW seconds, it starts falling back to V1 according to TF. At PER seconds, it returns immediately to V1 and a new period starts.</p></body></html>"

                            V1 {
                                label = "Initial value"
                                widget = edit
                                type = generic
                                default_value = "-1"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            V2 {
                                label = "Pulse value"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD {
                                label = "Delay time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TR {
                                label = "Rise time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TF {
                                label = "Fall time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PW {
                                label = "Pulse width"
                                widget = edit
                                type = generic
                                default_value = "12.5e-3"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            PER {
                                label = "Period"
                                widget = edit
                                type = generic
                                default_value = "25e-3"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/vs_pulse.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                TD_prop = mdl.prop(item_handle, "TD")
                                get_text(TD_prop, "s")
                                TR_prop = mdl.prop(item_handle, "TR")
                                get_text(TR_prop, "s")
                                TF_prop = mdl.prop(item_handle, "TF")
                                get_text(TF_prop, "s")
                                PW_prop = mdl.prop(item_handle, "PW")
                                get_text(PW_prop, "s")
                                PER_prop = mdl.prop(item_handle, "PER")
                                get_text(PER_prop, "s")
                            
                                ignore = False
                                V1_prop = mdl.prop(item_handle, "V1")
                                V1_text, color = get_text(V1_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V1_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                V2_prop = mdl.prop(item_handle, "V2")
                                V2_text, color = get_text(V2_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V2_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7456, 8216
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "DC Voltage Source" {
                        layout = static
                        label = "Vdc"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 8160
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 7960
                            rotation = right
                            hide_name = True
                        ]

                        connect Vs1.n_node n_node as Connection2
                        connect Vs1.p_node p_node as Connection1

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">DC Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"V\" type element with a constant value as transient specification (voltage).</p></body></html>"

                            voltage {
                                label = "Voltage"
                                widget = edit
                                type = generic
                                default_value = "100"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE

                                CODE property_value_edited
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/vs_dc.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                                #
                                #PER_prop = mdl.prop(item_handle, "PER")
                                #get_text(PER_prop, "s")
                            
                                ignore = False
                                voltage_prop = mdl.prop(item_handle, "voltage")
                                voltage_text, color = get_text(voltage_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, voltage_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7456, 8080
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "AC Voltage Source" {
                        layout = static
                        label = "Vac"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 7992
                            rotation = right
                            hide_name = True
                        ]

                        connect Vs1.n_node n_node as Connection2
                        connect p_node Vs1.p_node as Connection1

                        VA = "100"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">AC Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"V\" type element with a \"SIN\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">If a positive Delay is set, the source will output a constant voltage for TD seconds. Negative values are also accepted.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The sine wave is multiplied to the expression exp(-THETA*(t-TD)).</p></body></html>"

                            VA {
                                label = "Amplitude"
                                widget = edit
                                type = generic
                                default_value = "311"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            FREQ {
                                label = "Frequency"
                                widget = edit
                                type = generic
                                default_value = "60"
                                unit = "Hz"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PHASE {
                                label = "Phase"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "°"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            V0 {
                                label = "Offset"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD {
                                label = "Delay"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            THETA {
                                label = "Attenuation Factor"
                                widget = edit
                                type = generic
                                default_value = "0"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/vs_ac.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                V0_prop = mdl.prop(item_handle, "V0")
                                get_text(V0_prop, "V")
                                TD_prop = mdl.prop(item_handle, "TD")
                                get_text(TD_prop, "s")
                            
                                ignore = False
                                VA_prop = mdl.prop(item_handle, "VA")
                                VA_text, color = get_text(VA_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, VA_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                FREQ_prop = mdl.prop(item_handle, "FREQ")
                                FREQ_text, color = get_text(FREQ_prop, "Hz")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, FREQ_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7688, 8080
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "Triangular Voltage Source" {
                        layout = static
                        label = "Vtri"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7920, 8032
                            rotation = right
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7920, 7952
                            rotation = right
                            hide_name = True
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7920, 8120
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        connect Vs1.p_node p_node as Connection1
                        connect Vs1.n_node n_node as Connection2

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Triangular Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"V\" type element with a \"PWL\" (piecewise-linear) transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output starts at VMIN and rises linearly to VMAX, reaching it after TR seconds. The output then decreases linearly to VMIN during TF seconds.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The frequency of the triangular wave is defined therefore by inverse of (TR+TF).</p></body></html>"

                            vmax {
                                label = "Maximum voltage"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            vmin {
                                label = "Minimum voltage"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            trise {
                                label = "Rise-time"
                                widget = edit
                                type = generic
                                default_value = "0.5"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            tfall {
                                label = "Fall-time"
                                widget = edit
                                type = generic
                                default_value = "0.5"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/vs_triangular.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                trise_prop = mdl.prop(item_handle, "trise")
                                get_text(trise_prop, "s")
                                tfall_prop = mdl.prop(item_handle, "tfall")
                                get_text(tfall_prop, "s")
                            
                                ignore = False
                                vmin_prop = mdl.prop(item_handle, "vmin")
                                vmin_text, color = get_text(vmin_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, vmin_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                vmax_prop = mdl.prop(item_handle, "vmax")
                                vmax_text, color = get_text(vmax_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, vmax_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7456, 8344
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "Small-signal AC Voltage Source" {
                        layout = static
                        label = "Vsmall"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 7992
                            rotation = right
                            hide_name = True
                        ]

                        connect Vs1.n_node n_node as Connection2
                        connect p_node Vs1.p_node as Connection1

                        PHASE = "0"
                        VA = "1"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Small-signal AC Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>Use this source to perform the AC small-signal analysis.</p></body></html>"

                            VA {
                                label = "Amplitude"
                                widget = edit
                                type = generic
                                default_value = "311"
                                unit = "V"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PHASE {
                                label = "Phase"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "°"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/small_signal_vac.svg')
                                
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                                
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                                
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                                
                                ignore = False
                                VA_prop = mdl.prop(item_handle, "VA")
                                VA_text, color = get_text(VA_prop, "V")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, VA_text, relpos_x = 0.5, relpos_y = 0.2, size = 8, trim_factor = 0.9)
                                
                                ignore = False
                                PHASE_prop = mdl.prop(item_handle, "PHASE")
                                PHASE_text, color = get_text(PHASE_prop, "°")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, PHASE_text, relpos_x = 0.5, relpos_y = 0.8, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7944, 8080
                        rotation = left
                        size = 64, 64
                    ]
                }
                [
                    position = 10504, 10408
                    size = 48, 48
                ]

                component Category Current {
                    layout = dynamic
                    component Subsystem "Exponent Current Source" {
                        layout = static
                        label = "Iexp"
                        component src_current Is1 {
                        }
                        [
                            position = 7896, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7896, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7896, 7968
                            rotation = right
                            hide_name = True
                        ]

                        connect Is1.n_node n_node as Connection2
                        connect p_node Is1.p_node as Connection1

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Exponent Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"I\" type element with a \"EXP\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output starts at the V1* current. At TD1 seconds, it rises exponentially to V2 according to TAU1. At TD2 seconds, it falls exponentially towards V1 according to TAU2.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">*This is the nomenclature used by Xyce.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The following equations describe the waveform:<br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">0 </p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">I(t) = V1 </p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">TD1 </p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">I(t) = V1 + (V2-V1)(1-exp(-(t-TD1)/TAU1))     [Eq1]</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">t > TD2:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">I(t) = Eq1 + (V1-V2)(1-exp(-(t-TD2)/TAU2))</p></body></html>"

                            V1 {
                                label = "Initial amplitude"
                                widget = edit
                                type = generic
                                default_value = "-5"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            V2 {
                                label = "Final amplitude"
                                widget = edit
                                type = generic
                                default_value = "5"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD1 {
                                label = "Rise delay time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TAU1 {
                                label = "Rise time constant"
                                widget = edit
                                type = generic
                                default_value = "0.01"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD2 {
                                label = "Delay fall time"
                                widget = edit
                                type = generic
                                default_value = "0.025"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TAU2 {
                                label = "Fall time constant"
                                widget = edit
                                type = generic
                                default_value = "0.01"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/cs_exp.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                TD1_prop = mdl.prop(item_handle, "TD1")
                                get_text(TD1_prop, "s")
                                TAU1_prop = mdl.prop(item_handle, "TAU1")
                                get_text(TAU1_prop, "s")
                                TD2_prop = mdl.prop(item_handle, "TD2")
                                get_text(TD2_prop, "s")
                                TAU2_prop = mdl.prop(item_handle, "TAU2")
                                get_text(TAU2_prop, "s")
                            
                                ignore = False
                                V1_prop = mdl.prop(item_handle, "V1")
                                V1_text, color = get_text(V1_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V1_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                V2_prop = mdl.prop(item_handle, "V2")
                                V2_text, color = get_text(V2_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V2_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7896, 8184
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "AC Current Source" {
                        layout = static
                        label = "Iac"
                        component src_current Is1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 7984
                            rotation = right
                            hide_name = True
                        ]

                        connect p_node Is1.p_node as Connection1
                        connect Is1.n_node n_node as Connection2

                        FREQ = "60"
                        VA = "1"

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">AC Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"I\" type element with a \"SIN\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">If a positive Delay is set, the source will output a constant current for TD seconds. Negative values are also accepted.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The sine wave is multiplied to the expression exp(-THETA*(t-TD)).</p></body></html>"

                            VA {
                                label = "Amplitude"
                                widget = edit
                                type = generic
                                default_value = "1e-9"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            FREQ {
                                label = "Frequency"
                                widget = edit
                                type = generic
                                default_value = "50e-9"
                                unit = "Hz"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PHASE {
                                label = "Phase"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "°"
                            }

                            V0 {
                                label = "Offset"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD {
                                label = "Delay"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            THETA {
                                label = "Attenuation Factor"
                                widget = edit
                                type = generic
                                default_value = "0"
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/cs_ac.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                V0_prop = mdl.prop(item_handle, "V0")
                                get_text(V0_prop, "A")
                                TD_prop = mdl.prop(item_handle, "TD")
                                get_text(TD_prop, "s")
                            
                                ignore = False
                                VA_prop = mdl.prop(item_handle, "VA")
                                VA_text, color = get_text(VA_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, VA_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                FREQ_prop = mdl.prop(item_handle, "FREQ")
                                FREQ_text, color = get_text(FREQ_prop, "Hz")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, FREQ_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 8152, 8080
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "DC Current Source" {
                        layout = static
                        label = "Idc"
                        component src_current Is1 {
                        }
                        [
                            position = 7896, 8064
                            rotation = right
                        ]

                        port p_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7896, 7968
                            rotation = right
                            hide_name = True
                        ]

                        port n_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7896, 8152
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        connect p_node Is1.p_node as Connection1
                        connect Is1.n_node n_node as Connection2

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">DC Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"I\" type element with a constant value as transient specification (current).</p></body></html>"

                            current {
                                label = "Current"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/cs_dc.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                ignore = False
                                current_prop = mdl.prop(item_handle, "current")
                                current_text, color = get_text(current_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, current_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 7896, 8072
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "Pulse Current Source" {
                        layout = static
                        label = "Ipulse"
                        component src_current Is1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port p_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 7976
                            rotation = right
                            hide_name = True
                        ]

                        port n_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        connect Is1.n_node n_node as Connection2
                        connect Is1.p_node p_node as Connection1

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Pulse Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"I\" type element with a \"PULSE\" transient specification.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The source output starts at the value defined by V1* and immediately rises to V2 according to TR. After PW seconds, it starts falling back to V1 according to TF. At PER seconds, it returns immediately to V1 and a new period starts.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">*This is the nomenclature used by Xyce.</p></body></html>"

                            V1 {
                                label = "Initial value"
                                widget = edit
                                type = generic
                                default_value = "-1"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            V2 {
                                label = "Pulse value"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TD {
                                label = "Delay time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TR {
                                label = "Rise time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            TF {
                                label = "Fall time"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PW {
                                label = "Pulse width"
                                widget = edit
                                type = generic
                                default_value = "0.0125"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PER {
                                label = "Period"
                                widget = edit
                                type = generic
                                default_value = "0.025"
                                unit = "s"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/cs_pulse.svg')
                            
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                            
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                            
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                            
                                TD_prop = mdl.prop(item_handle, "TD")
                                get_text(TD_prop, "s")
                                TR_prop = mdl.prop(item_handle, "TR")
                                get_text(TR_prop, "s")
                                TF_prop = mdl.prop(item_handle, "TF")
                                get_text(TF_prop, "s")
                                PW_prop = mdl.prop(item_handle, "PW")
                                get_text(PW_prop, "s")
                                PER_prop = mdl.prop(item_handle, "PER")
                                get_text(PER_prop, "s")
                            
                                ignore = False
                                V1_prop = mdl.prop(item_handle, "V1")
                                V1_text, color = get_text(V1_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V1_text, relpos_x = 0.5, relpos_y = 0.9, size = 8, trim_factor = 0.9)
                            
                                ignore = False
                                V2_prop = mdl.prop(item_handle, "V2")
                                V2_text, color = get_text(V2_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, V2_text, relpos_x = 0.5, relpos_y = 0.12, size = 8, trim_factor = 0.9)
                            
                            ENDCODE
                        }
                    }
                    [
                        position = 8152, 8176
                        rotation = left
                        size = 64, 64
                    ]

                    component Subsystem "Small-signal AC Current Source" {
                        layout = static
                        label = "Ismall"
                        component src_voltage Vs1 {
                        }
                        [
                            position = 7904, 8064
                            rotation = right
                        ]

                        port n_node {
                            position = left center
                            kind = pe
                        }
                        [
                            position = 7904, 8144
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                        ]

                        port p_node {
                            position = right center
                            kind = pe
                        }
                        [
                            position = 7904, 7992
                            rotation = right
                            hide_name = True
                        ]

                        connect Vs1.n_node n_node as Connection2
                        connect p_node Vs1.p_node as Connection1

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Small-signal AC Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>Use this source to perform the AC small-signal analysis.</p></body></html>"

                            VA {
                                label = "Amplitude"
                                widget = edit
                                type = generic
                                default_value = "1"
                                unit = "A"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            PHASE {
                                label = "Phase"
                                widget = edit
                                type = generic
                                default_value = "0"
                                unit = "°"

                                CODE property_value_changed
                                    mdl.refresh_icon(container_handle)
                                ENDCODE
                            }

                            meas_v {
                                label = "Voltage"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_i {
                                label = "Current"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            meas_p {
                                label = "Power"
                                widget = checkbox
                                type = bool
                                default_value = "False"
                                group = "Measurements"
                                no_evaluate
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                                
                            ENDCODE

                            CODE define_icon
                                mdl.set_component_icon_image(item_handle, 'images/small_signal_iac.svg')
                                
                                def unit_conv(value, unit):
                                    if value == 0:
                                        pass
                                    elif value < 1e-9:
                                        value = value * 1e12
                                        unit = "p" + unit
                                    elif value < 1e-6:
                                        value = value * 1e9
                                        unit = "n" + unit
                                    elif value < 1e-3:
                                        value = value * 1e6
                                        unit = "μ" + unit
                                    elif value < 1:
                                        value = value * 1e3
                                        unit = "m" + unit
                                    elif value < 1e3:
                                        pass
                                    elif value < 1e6:
                                        value = value * 1e-3
                                        unit = "k" + unit
                                    elif value < 1e9:
                                        value = value * 1e-6
                                        unit = "M" + unit
                                    elif value < 1e12:
                                        value = value * 1e-9
                                        unit = "G" + unit
                                    return (value, unit)
                                
                                def prefix_to_scientific(prefix):
                                    if prefix == "p":
                                        return "e-12"
                                    if prefix == "n":
                                        return "e-9"
                                    if prefix == "u":
                                        return "e-6"
                                    if prefix == "m":
                                        return "e-3"
                                    if prefix == "k":
                                        return "e3"
                                    if prefix == "M":
                                        return "e6"
                                    if prefix == "G":
                                        return "e9"
                                
                                def get_text(prop_handle, unit):
                                    val = mdl.get_property_value(prop_handle)
                                    # If val is not a string
                                    if not isinstance(val, str):
                                        if val < 0:
                                            val, unit = unit_conv(-val, unit)
                                            val = -val
                                        else:
                                            val, unit = unit_conv(val, unit)
                                        color = "blue"
                                        inside_text = f"{val} {unit}"
                                        return (inside_text, color)
                                    # In case a variable (or a unit prefix) is being used
                                    else:
                                        try:
                                            import re
                                            matching = re.match(r"(-?[0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                            if matching.group(2):
                                                nonlocal ignore
                                                n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                                # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                                mdl.set_property_value(prop_handle, n_val)
                                                ignore = True
                                                return ("", "")
                                        except:
                                            color = "green"
                                            inside_text = f"{val}"
                                            return (inside_text, color)
                                
                                ignore = False
                                VA_prop = mdl.prop(item_handle, "VA")
                                VA_text, color = get_text(VA_prop, "A")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, VA_text, relpos_x = 0.5, relpos_y = 0.2, size = 8, trim_factor = 0.9)
                                
                                ignore = False
                                PHASE_prop = mdl.prop(item_handle, "PHASE")
                                PHASE_text, color = get_text(PHASE_prop, "°")
                                if not ignore == True:
                                    mdl.set_color(item_handle, color)
                                    mdl.disp_component_icon_text(item_handle, PHASE_text, relpos_x = 0.5, relpos_y = 0.8, size = 8, trim_factor = 0.9)
                            ENDCODE
                        }
                    }
                    [
                        position = 8416, 8080
                        rotation = left
                        size = 64, 64
                    ]
                }
                [
                    position = 10592, 10408
                    size = 48, 48
                ]
            }
            [
                position = 7472, 8112
                size = 96, 104
            ]

            component Category "Controlled Sources" {
                layout = dynamic
                component Subsystem "Voltage-Controlled Current Source" {
                    layout = static
                    label = "VCCS"
                    component el_short "Short Circuit1" {
                    }
                    [
                        position = 7904, 7992
                    ]

                    component el_short "Short Circuit" {
                    }
                    [
                        position = 7904, 8064
                    ]

                    port p_ctrl {
                        label = "Ctrl+"
                        position = 12.0, -26.0
                        kind = pe
                    }
                    [
                        position = 7768, 7992
                        hide_name = True
                    ]

                    port n_ctrl {
                        label = "Ctrl-"
                        position = -12.0, -26.0
                        kind = pe
                    }
                    [
                        position = 8040, 7992
                        hide_name = True
                        scale = -1, 1
                    ]

                    port p_node {
                        label = "+"
                        position = left center
                        kind = pe
                    }
                    [
                        position = 7768, 8064
                        hide_name = True
                    ]

                    port n_node {
                        label = "-"
                        position = right center
                        kind = pe
                    }
                    [
                        position = 8040, 8064
                        hide_name = True
                        scale = -1, 1
                    ]

                    connect "Short Circuit1.n_node" n_ctrl as Connection4
                    connect p_ctrl "Short Circuit1.p_node" as Connection3
                    connect "Short Circuit.n_node" n_node as Connection2
                    connect p_node "Short Circuit.p_node" as Connection1

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Voltage-Controlled Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"G\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The differential voltage measured between + and - terminals controls the current output according to the transcondutance (gm) value.</p></body></html>"

                        transc {
                            label = "Transconductance"
                            widget = edit
                            type = generic
                            default_value = "1"

                            CODE property_value_changed
                                mdl.refresh_icon(container_handle)
                            ENDCODE
                        }

                        meas_v {
                            label = "Voltage"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_i {
                            label = "Current"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_p {
                            label = "Power"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                        
                        ENDCODE

                        CODE define_icon
                            mdl.set_component_icon_image(item_handle, 'images/vccs.svg')
                        
                            transc_prop = mdl.prop(item_handle, "transc")
                            transc = mdl.get_property_value(transc_prop)
                        
                            text = f" gm = {transc}"
                        
                            mdl.set_color(item_handle, "blue")
                            mdl.disp_component_icon_text(item_handle, text, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                        ENDCODE
                    }
                }
                [
                    position = 7872, 8128
                    rotation = left
                    size = 64, 64
                ]

                component Subsystem "Current-Controlled Current Source" {
                    layout = static
                    label = "CCCS"
                    component el_short "Short Circuit" {
                    }
                    [
                        position = 7904, 8064
                    ]

                    port p_node {
                        label = "+"
                        position = left center
                        kind = pe
                    }
                    [
                        position = 7768, 8064
                        hide_name = True
                    ]

                    port n_node {
                        label = "-"
                        position = right center
                        kind = pe
                    }
                    [
                        position = 8040, 8064
                        hide_name = True
                        scale = -1, 1
                    ]

                    connect "Short Circuit.n_node" n_node as Connection2
                    connect p_node "Short Circuit.p_node" as Connection1

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Current-Controlled Current Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"F\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A controlling current must be selected from the list of current measurements added to the circuit. The current output is controlled according to the selected current and the gain (g) value.</p></body></html>"

                        gain {
                            label = "Gain"
                            widget = edit
                            type = generic
                            default_value = "1"

                            CODE property_value_changed
                                mdl.refresh_icon(container_handle)
                            ENDCODE
                        }

                        ctrl_name {
                            label = "Controlling measurement name"
                            widget = combo
                            combo_values = "None"
                            type = string
                            default_value = "None"
                            no_evaluate

                            CODE property_value_changed
                                mdl.refresh_icon(container_handle)
                            ENDCODE
                        }

                        update_currents {
                            label = "Update current measurements"
                            widget = button
                            type = string
                            default_value = "Update"
                            no_evaluate

                            CODE button_clicked
                                update_current_measurements(mdl, container_handle)
                            ENDCODE
                        }

                        meas_v {
                            label = "Voltage"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_i {
                            label = "Current"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_p {
                            label = "Power"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                        
                        ENDCODE

                        CODE define_icon
                            ctrl_name_prop = mdl.prop(item_handle, "ctrl_name")
                            ctrl_name = mdl.get_property_disp_value(ctrl_name_prop)
                        
                            mdl.set_component_icon_image(item_handle, 'images/cccs.svg')
                        
                            if not ctrl_name == "None":
                                mdl.set_component_icon_image(item_handle, 'images/cccs_active.svg')
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + ctrl_name, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                        ENDCODE

                        CODE init
                            # Return all components (including inside subsystems)
                            def all_circuit_components(model, parent_comp=None):
                                component_list = []
                                if parent_comp:  # Component inside a subsystem (recursive function)
                                    all_components = model.get_items(parent_comp)
                                else:  # Top level call
                                    all_components = model.get_items()

                                for comp in all_components:
                                    try:
                                        type_name = model.get_component_type_name(comp)
                                        if type_name:
                                            component_list.append(comp)
                                        else:  # Component is a subsystem
                                            component_list.extend(all_circuit_components(model, comp))
                                    except:
                                        # Some components (such as ports and connections) cannot be used with
                                        # get_component_type_name
                                        pass
                                # Return the list of component handles
                                return component_list

                            def update_current_measurements(mdl, item_handle):
                                i_list = []
                        
                                for item in all_circuit_components(mdl):
                                    try: # Not every component has a type
                                        if mdl.get_component_type_name(item) == "Current Measurement":
                                            i_list.append(item.fqn)
                                    except AttributeError: pass
                        
                                for item in all_circuit_components(mdl):
                                    try: # Not every component has a type
                                        if mdl.get_component_type_name(item) == "Current-Controlled Current Source":
                                            ctrl_name_prop = mdl.prop(item, "ctrl_name")
                                            mdl.set_property_combo_values(ctrl_name_prop, i_list)
                                            displayed_ctrl = mdl.get_property_disp_value(ctrl_name_prop)
                                            if displayed_ctrl not in i_list:
                                                mdl.set_property_value(ctrl_name_prop, "None")
                                                mdl.refresh_icon(item)
                                    except AttributeError: pass
                        
                            update_current_measurements(mdl, item_handle)
                        ENDCODE
                    }
                }
                [
                    position = 7872, 8248
                    rotation = left
                    size = 64, 64
                ]

                component Subsystem "Current-Controlled Voltage Source" {
                    layout = static
                    label = "CCVS"
                    component el_short "Short Circuit" {
                    }
                    [
                        position = 7904, 8064
                    ]

                    port n_node {
                        label = "-"
                        position = left center
                        kind = pe
                    }
                    [
                        position = 8040, 8064
                        hide_name = True
                        scale = -1, 1
                    ]

                    port p_node {
                        label = "+"
                        position = right center
                        kind = pe
                    }
                    [
                        position = 7768, 8064
                        hide_name = True
                    ]

                    connect "Short Circuit.n_node" n_node as Connection2
                    connect p_node "Short Circuit.p_node" as Connection1

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Current-Controlled Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"H\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A controlling current must be selected from the list of current measurements added to the circuit. The voltage output is controlled according to the selected current and the transresistance (rm) value. </p></body></html>"

                        transr {
                            label = "Transresistance"
                            widget = edit
                            type = generic
                            default_value = "1"

                            CODE property_value_changed
                                refresh_all_ccvs_icons(mdl, container_handle)
                            ENDCODE
                        }

                        ctrl_name {
                            label = "Controlling measurement name"
                            widget = combo
                            combo_values = "None"
                            type = string
                            default_value = "None"
                            no_evaluate

                            CODE property_value_changed
                                refresh_all_ccvs_icons(mdl, container_handle)
                            ENDCODE
                        }

                        update_currents {
                            label = "Update current measurements"
                            widget = button
                            type = string
                            default_value = "Update"
                            no_evaluate

                            CODE button_clicked
                                update_current_measurements(mdl, container_handle)
                            ENDCODE
                        }

                        meas_v {
                            label = "Voltage"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_i {
                            label = "Current"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_p {
                            label = "Power"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                        
                        ENDCODE

                        CODE define_icon
                            ctrl_name_prop = mdl.prop(item_handle, "ctrl_name")
                            ctrl_name = mdl.get_property_disp_value(ctrl_name_prop)
                        
                            mdl.set_component_icon_image(item_handle, 'images/ccvs.svg')
                        
                            if not ctrl_name == "None":
                                mdl.set_component_icon_image(item_handle, 'images/ccvs_active.svg')
                                mdl.set_color(item_handle, "blue")
                                mdl.disp_component_icon_text(item_handle, " " + ctrl_name, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                        ENDCODE

                        CODE init
                            # Return all components (including inside subsystems)
                            def all_circuit_components(model, parent_comp=None):
                                component_list = []
                                if parent_comp:  # Component inside a subsystem (recursive function)
                                    all_components = model.get_items(parent_comp)
                                else:  # Top level call
                                    all_components = model.get_items()

                                for comp in all_components:
                                    try:
                                        type_name = model.get_component_type_name(comp)
                                        if type_name:
                                            component_list.append(comp)
                                        else:  # Component is a subsystem
                                            component_list.extend(all_circuit_components(model, comp))
                                    except:
                                        # Some components (such as ports and connections) cannot be used with
                                        # get_component_type_name
                                        pass
                                # Return the list of component handles
                                return component_list

                            def update_current_measurements(mdl, item_handle):
                                i_list = []
                        
                                for item in all_circuit_components(mdl):
                                    try: # Not every component has a type
                                        if mdl.get_component_type_name(item) == "Current Measurement":
                                            i_list.append(item.fqn)
                                    except AttributeError: pass
                        
                                for item in all_circuit_components(mdl):
                                    try: # Not every component has a type
                                        if mdl.get_component_type_name(item) == "Current-Controlled Voltage Source":
                                            ctrl_name_prop = mdl.prop(item, "ctrl_name")
                                            mdl.set_property_combo_values(ctrl_name_prop, i_list)
                                            displayed_ctrl = mdl.get_property_disp_value(ctrl_name_prop)
                                            if displayed_ctrl not in i_list:
                                                mdl.set_property_value(ctrl_name_prop, "None")
                                    except AttributeError: pass
                        
                            def refresh_all_ccvs_icons(mdl, item_handle):
                                for item in all_circuit_components(mdl):
                                    try: # Not every component has a type
                                        if mdl.get_component_type_name(item) == "Current-Controlled Voltage Source":
                                            mdl.refresh_icon(item)
                                    except AttributeError: pass
                        
                            update_current_measurements(mdl, item_handle)
                        ENDCODE
                    }
                }
                [
                    position = 8232, 8248
                    rotation = left
                    size = 64, 64
                ]

                component Subsystem "Voltage-Controlled Voltage Source" {
                    layout = static
                    label = "VCVS"
                    component el_short "Short Circuit" {
                    }
                    [
                        position = 7848, 8064
                    ]

                    component el_short "Short Circuit1" {
                    }
                    [
                        position = 7848, 7968
                    ]

                    component el_short "Short Circuit2" {
                    }
                    [
                        position = 7976, 8016
                        rotation = right
                    ]

                    port p_node {
                        label = "+"
                        position = right center
                        kind = pe
                    }
                    [
                        position = 7768, 8064
                        hide_name = True
                    ]

                    port n_ctrl {
                        label = "Ctrl-"
                        position = -12.0, -25.0
                        kind = pe
                    }
                    [
                        position = 8040, 7968
                        hide_name = True
                        scale = -1, 1
                    ]

                    port n_node {
                        label = "-"
                        position = left center
                        kind = pe
                    }
                    [
                        position = 8040, 8064
                        hide_name = True
                        scale = -1, 1
                    ]

                    port p_ctrl {
                        label = "Ctrl+"
                        position = 12.0, -25.0
                        kind = pe
                    }
                    [
                        position = 7768, 7968
                        hide_name = True
                    ]

                    junction Junction1 pe
                    [
                        position = 7976, 7968
                    ]

                    junction Junction2 pe
                    [
                        position = 7976, 8064
                    ]

                    connect p_ctrl "Short Circuit1.p_node" as Connection3
                    connect p_node "Short Circuit.p_node" as Connection1
                    connect "Short Circuit1.n_node" Junction1 as Connection5
                    connect Junction1 n_ctrl as Connection6
                    connect "Short Circuit2.p_node" Junction1 as Connection7
                    connect "Short Circuit.n_node" Junction2 as Connection8
                    connect Junction2 n_node as Connection9
                    connect "Short Circuit2.n_node" Junction2 as Connection10

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Voltage-Controlled Voltage Source</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is an \"E\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The differential voltage measured between + and - terminals controls the voltage output according to the gain (g) value.</p></body></html>"

                        gain {
                            label = "Gain"
                            widget = edit
                            type = generic
                            default_value = "1"

                            CODE property_value_changed
                                mdl.refresh_icon(container_handle)
                            ENDCODE
                        }

                        meas_v {
                            label = "Voltage"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_i {
                            label = "Current"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        meas_p {
                            label = "Power"
                            widget = checkbox
                            type = bool
                            default_value = "False"
                            group = "Measurements"
                            no_evaluate
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                        
                        ENDCODE

                        CODE define_icon
                            mdl.set_component_icon_image(item_handle, 'images/vcvs.svg')
                        
                            gain_prop = mdl.prop(item_handle, "gain")
                            gain = mdl.get_property_value(gain_prop)
                        
                            text = f" g = {gain}"
                        
                            mdl.set_color(item_handle, "blue")
                            mdl.disp_component_icon_text(item_handle, text, relpos_x = 0.5, relpos_y = 0.87, size = 8)
                        ENDCODE
                    }
                }
                [
                    position = 8232, 8128
                    rotation = left
                    size = 64, 64
                ]
            }
            [
                position = 7672, 8112
                size = 96, 104
            ]

            component src_ground Ground {
            }
            [
                position = 7280, 8120
            ]
        }
        [
            position = 7872, 8016
            size = 96, 104
        ]

        component Category "Transmission Lines" {
            layout = dynamic
            component Subsystem "Lossy Transmission Line" {
                layout = static
                label = "TL"
                component el_short "Short Circuit1" {
                }
                [
                    position = 7904, 7992
                ]

                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                port P1_n {
                    label = "P1-"
                    position = -64.0, 20.0
                    kind = pe
                }
                [
                    position = 7768, 8064
                ]

                port P2_n {
                    label = "P2-"
                    position = 64.0, 20.0
                    kind = pe
                }
                [
                    position = 8040, 8064
                    scale = -1, 1
                ]

                port P1_p {
                    label = "P1+"
                    position = -64.0, -20.0
                    kind = pe
                }
                [
                    position = 7768, 7992
                ]

                port P2_p {
                    label = "P2+"
                    position = 64.0, -20.0
                    kind = pe
                }
                [
                    position = 8040, 7992
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" P2_n as Connection2
                connect "Short Circuit1.n_node" P2_p as Connection4
                connect P1_n "Short Circuit.p_node" as Connection1
                connect P1_p "Short Circuit1.p_node" as Connection3

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Lossy Transmission Line</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"O\" type element, a distributed parameters line model.</p></body></html>"

                    LEN {
                        label = "Line length"
                        widget = edit
                        type = generic
                        default_value = "500"
                        unit = "m"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    R {
                        label = "Resistance per meter"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "Ω/m"
                    }

                    C {
                        label = "Capacitance per meter"
                        widget = edit
                        type = generic
                        default_value = "10e-9"
                        unit = "C/m"
                    }

                    L {
                        label = "Inductance per meter"
                        widget = edit
                        type = generic
                        default_value = "100e-9"
                        unit = "L/m"
                    }

                    interp {
                        label = "Interpolation Type"
                        widget = combo
                        combo_values = "Quadratic", "Mixed", "Linear"
                        type = string
                        default_value = "Quadratic"
                        group = "Advanced"
                        no_evaluate
                    }

                    steplimit {
                        label = "Can reduce time-step for accuracy"
                        widget = checkbox
                        type = bool
                        default_value = "True"
                        group = "Advanced"
                        no_evaluate
                    }

                    complexstepcontrol {
                        label = "Step control by LTE estimation"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Advanced"
                        no_evaluate
                    }

                    rel {
                        label = "Relat. rate of change of derivative for breakpoint"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "Advanced"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/lossy_tl.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        len_prop = mdl.prop(item_handle, "LEN")
                        len_text, color = get_text(len_prop, "m")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color)
                            mdl.disp_component_icon_text(item_handle, len_text, relpos_x = 0.5, relpos_y = 0.5, size = 8)
                    ENDCODE
                }
            }
            [
                position = 7856, 8000
                size = 128, 64
            ]

            component Subsystem "Lumped Transmission Line" {
                layout = static
                label = "TL"
                component el_short "Short Circuit1" {
                }
                [
                    position = 7904, 7992
                ]

                port P1_p {
                    label = "P1+"
                    position = left center
                    kind = pe
                }
                [
                    position = 7768, 7992
                ]

                port P2_p {
                    label = "P2+"
                    position = right center
                    kind = pe
                }
                [
                    position = 8040, 7992
                    scale = -1, 1
                ]

                connect P1_p "Short Circuit1.p_node" as Connection3
                connect "Short Circuit1.n_node" P2_p as Connection4

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Lumped Transmission Line</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"ytransline\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The Lumped Transmission Line approximates the line by a series of RLC sections.</p></body></html>"

                    LEN {
                        label = "Line length"
                        widget = edit
                        type = generic
                        default_value = "500"
                        unit = "m"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    R {
                        label = "Resistance per meter"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "Ω/m"
                    }

                    C {
                        label = "Capacitance per meter"
                        widget = edit
                        type = generic
                        default_value = "10e-9"
                        unit = "C/m"
                    }

                    L {
                        label = "Inductance per meter"
                        widget = edit
                        type = generic
                        default_value = "100e-9"
                        unit = "L/m"
                    }

                    LUMPS {
                        label = "Number of sections"
                        widget = edit
                        type = generic
                        default_value = "50"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/lumped_tl.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        len_prop = mdl.prop(item_handle, "LEN")
                        lumps_prop = mdl.prop(item_handle, "LUMPS")
                    
                        len_text, color_len = get_text(len_prop, "m")
                        lumps_text, color_lumps = get_text(lumps_prop, "")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color_len)
                            mdl.disp_component_icon_text(item_handle, len_text, relpos_x = 0.5, relpos_y = 0.11, size = 8)
                            mdl.set_color(item_handle, color_lumps)
                            mdl.disp_component_icon_text(item_handle, "x"+lumps_text, relpos_x = 0.5, relpos_y = 0.5, size = 8)
                    ENDCODE
                }
            }
            [
                position = 8056, 8000
                size = 64, 64
            ]

            component Subsystem "Ideal Transmission Line" {
                layout = static
                label = "TL"
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7904, 7992
                ]

                port P1_p {
                    label = "P1+"
                    position = -64.0, -20.0
                    kind = pe
                }
                [
                    position = 7768, 7992
                ]

                port P1_n {
                    label = "P1-"
                    position = -64.0, 20.0
                    kind = pe
                }
                [
                    position = 7768, 8064
                ]

                port P2_p {
                    label = "P2+"
                    position = 64.0, -20.0
                    kind = pe
                }
                [
                    position = 8040, 7992
                    scale = -1, 1
                ]

                port P2_n {
                    label = "P2-"
                    position = 64.0, 20.0
                    kind = pe
                }
                [
                    position = 8040, 8064
                    scale = -1, 1
                ]

                connect P1_n "Short Circuit.p_node" as Connection1
                connect "Short Circuit.n_node" P2_n as Connection2
                connect "Short Circuit1.n_node" P2_p as Connection4
                connect P1_p "Short Circuit1.p_node" as Connection3

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Ideal Transmission Line</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In Xyce, this is a \"T\" type element.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The line length is indirectly defined by the time delay (TD).</p></body></html>"

                    Z0 {
                        label = "Characteristic Impedance (Z0)"
                        widget = edit
                        type = generic
                        default_value = "50"
                        unit = "Ω"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    TD {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "10e-3"
                        unit = "s"

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/ideal_tl.svg')
                    
                        ignore = False
                        def unit_conv(value, unit):
                            if value == 0:
                                pass
                            elif value < 1e-9:
                                value = value * 1e12
                                unit = "p" + unit
                            elif value < 1e-6:
                                value = value * 1e9
                                unit = "n" + unit
                            elif value < 1e-3:
                                value = value * 1e6
                                unit = "μ" + unit
                            elif value < 1:
                                value = value * 1e3
                                unit = "m" + unit
                            elif value < 1e3:
                                pass
                            elif value < 1e6:
                                value = value * 1e-3
                                unit = "k" + unit
                            elif value < 1e9:
                                value = value * 1e-6
                                unit = "M" + unit
                            elif value < 1e12:
                                value = value * 1e-9
                                unit = "G" + unit
                            return (value, unit)
                    
                        def prefix_to_scientific(prefix):
                            if prefix == "p":
                                return "e-12"
                            if prefix == "n":
                                return "e-9"
                            if prefix == "u":
                                return "e-6"
                            if prefix == "m":
                                return "e-3"
                            if prefix == "k":
                                return "e3"
                            if prefix == "M":
                                return "e6"
                            if prefix == "G":
                                return "e9"
                    
                        def get_text(prop_handle, unit):
                            val = mdl.get_property_value(prop_handle)
                            # If val is not a string
                            if not isinstance(val, str):
                                val, unit = unit_conv(val, unit)
                                color = "blue"
                                inside_text = f"{val} {unit}"
                                return (inside_text, color)
                            # In case a variable (or a unit prefix) is being used
                            else:
                                try:
                                    import re
                                    matching = re.match(r"([0-9.]+)\s*(p|n|u|m|k|M|G)", val)
                                    if matching.group(2):
                                        nonlocal ignore
                                        n_val = matching.group(1) + prefix_to_scientific(matching.group(2))
                                        # The property must have mdl.refresh_icon(container_handle) in property_value_edited
                                        mdl.set_property_value(prop_handle, n_val)
                                        ignore = True
                                        return ("", "")
                                except:
                                    color = "green"
                                    inside_text = f"{val}"
                                    return (inside_text, color)
                    
                        TD_prop = mdl.prop(item_handle, "TD")
                        Z0_prop = mdl.prop(item_handle, "Z0")
                    
                        TD_text, color1 = get_text(TD_prop, "s")
                        Z0_text, color2 = get_text(Z0_prop, "Ω")
                    
                        if not ignore == True:
                            mdl.set_color(item_handle, color1)
                            mdl.disp_component_icon_text(item_handle, TD_text, relpos_x = 0.7, relpos_y = 0.5, size = 8, trim_factor = 0.4)
                            mdl.set_color(item_handle, color2)
                            mdl.disp_component_icon_text(item_handle, Z0_text, relpos_x = 0.3, relpos_y = 0.5, size = 8, trim_factor = 0.4)
                    ENDCODE

                    CODE post_resolve
                    ENDCODE
                }
            }
            [
                position = 7616, 8000
                size = 128, 64
            ]
        }
        [
            position = 8096, 8208
            size = 96, 104
        ]

        component Category Electronics {
            layout = dynamic
            component Subsystem "Operational Amplifier" {
                layout = static
                label = "OpAmp"
                component "xyce_lib/Ideal Resistor" Rin {
                    R = "10e6"
                }
                [
                    position = 7912, 8168
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Voltage-Controlled Voltage Source" Gain {
                    gain = "gain"
                }
                [
                    position = 8040, 8168
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Capacitor" Cf {
                    C = "Cf"
                }
                [
                    position = 8272, 8176
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Resistor" Rf {
                    R = "Rf"
                }
                [
                    position = 8152, 8112
                    size = 64, 64
                ]

                component "xyce_lib/Voltage-Controlled Voltage Source" Eout {
                    gain = "gain"
                }
                [
                    position = 8408, 8176
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Resistor" RGND2 {
                    R = "1"
                }
                [
                    position = 8408, 8296
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Resistor" RGND {
                    R = "1"
                }
                [
                    position = 8040, 8296
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Resistor" Rout {
                }
                [
                    position = 8512, 8112
                    size = 64, 64
                ]

                component src_ground gnd1 {
                }
                [
                    position = 8248, 8400
                ]

                port inv {
                    position = -32.0, 20.0
                    kind = pe
                }
                [
                    position = 7832, 8240
                    hide_name = True
                ]

                port non_inv {
                    position = -32.0, -20.0
                    kind = pe
                }
                [
                    position = 7832, 8112
                    hide_name = True
                ]

                port Out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8608, 8112
                    rotation = down
                    hide_name = True
                ]

                junction Junction11 pe
                [
                    position = 7912, 8112
                ]

                junction Junction14 pe
                [
                    position = 8248, 8344
                ]

                junction Junction15 pe
                [
                    position = 8040, 8232
                ]

                junction Junction17 pe
                [
                    position = 7912, 8240
                ]

                junction Junction18 pe
                [
                    position = 8272, 8232
                ]

                junction Junction19 pe
                [
                    position = 8272, 8112
                ]

                connect Gain.p_node Rf.p_node as Connection92
                connect Rout.n_node Out as Connection109
                connect Rout.p_node Eout.p_node as Connection110
                connect non_inv Junction11 as Connection138
                connect Junction11 Gain.p_ctrl as Connection139
                connect Rin.n_node Junction11 as Connection140
                connect RGND2.n_node Eout.n_node as Connection146
                connect gnd1.node Junction14 as Connection150
                connect Junction14 RGND2.p_node as Connection151
                connect RGND.p_node Junction14 as Connection152
                [
                    position = 0, 0
                    breakpoints = 8040, 8344; 8248, 8344
                ]
                connect RGND.n_node Junction15 as Connection155
                [
                    position = 0, 0
                    breakpoints = 8040, 8248
                ]
                connect Junction15 Gain.n_node as Connection156
                connect inv Junction17 as Connection162
                connect Junction17 Rin.p_node as Connection163
                [
                    position = 0, 0
                    breakpoints = 7912, 8240
                ]
                connect Gain.n_ctrl Junction17 as Connection164
                connect Cf.p_node Junction18 as Connection166
                connect Junction18 Junction15 as Connection167
                [
                    position = 0, 0
                    breakpoints = 8272, 8232
                ]
                connect Eout.n_ctrl Junction18 as Connection168
                connect Cf.n_node Junction19 as Connection170
                connect Junction19 Rf.n_node as Connection171
                [
                    position = 0, 0
                    breakpoints = 8272, 8112; 8272, 8112
                ]
                connect Eout.p_ctrl Junction19 as Connection172

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Operational Amplifier</p></body></html>"

                    model_type {
                        label = "Model type"
                        widget = combo
                        combo_values = "Ideal", "Low-pass filter"
                        type = string
                        default_value = "Ideal"
                        no_evaluate
                    }

                    gain {
                        label = "Large Signal Gain"
                        widget = edit
                        type = generic
                        default_value = "1000000"
                        unit = "V/V"
                    }

                    Rf {
                        label = "Rf"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        unit = "ohms"

                        CODE property_value_changed
                            new_filter_cap(mdl, container_handle)
                        ENDCODE
                    }

                    Cf {
                        label = "Cf"
                        widget = edit
                        type = generic
                        default_value = "1.5915494309188487e-05"
                        unit = "F"
                        nonvisible
                    }

                    fp {
                        label = "Filter pole frequency"
                        widget = edit
                        type = generic
                        default_value = "10"
                        unit = "Hz"

                        CODE property_value_changed
                            new_filter_cap(mdl, container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/op_amp.svg')
                    ENDCODE

                    CODE init
                        def new_filter_cap(mdl, item_handle):
                            fp_prop = mdl.prop(item_handle, "fp")
                            fp = mdl.get_property_value(fp_prop)
                    
                            Rf_prop = mdl.prop(item_handle, "Rf")
                            Rf = mdl.get_property_value(Rf_prop)
                    
                            try:
                                pi = 3.14159265359
                                cap = 1/(2*pi*fp*Rf)
                    
                                Cf = mdl.prop(item_handle, "Cf")
                                mdl.set_property_value(Cf, cap)
                    
                            except ZeroDivisionError:
                                mdl.info("Filter resistor and capacitor cannot be set to zero.")
                                mdl.set_property_value(fp_prop, fp)
                                mdl.set_property_value(Rf_prop, Rf)
                    ENDCODE
                }
            }
            [
                position = 7568, 7968
                size = 64, 64
            ]

            component Subsystem "Ideal Comparator" {
                layout = static
                label = "CMP"
                component src_ground gnd1 {
                }
                [
                    position = 8000, 8432
                ]

                component "xyce_lib/Ideal Resistor" R_OUT {
                    R = "2"
                }
                [
                    position = 8272, 8264
                    rotation = right
                    size = 64, 64
                ]

                component "xyce_lib/Ideal Resistor" R_VCC {
                    R = "1"
                }
                [
                    position = 8104, 8080
                    rotation = right
                    size = 64, 64
                ]

                component "xyce_lib/Voltage-Controlled Switch" Sw {
                    r_on = "2"
                }
                [
                    position = 8104, 8216
                    rotation = left
                    size = 64, 64
                ]

                component "core/Current Measurement" Ia1 {
                }
                [
                    position = 8104, 8320
                    rotation = right
                    size = 64, 32
                ]

                component "xyce_lib/Current-Controlled Voltage Source" H_VOUT {
                    transr = "4"
                }
                [
                    position = 8416, 8264
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/DC Voltage Source" V_VCC {
                    voltage = "3.3"
                }
                [
                    position = 7896, 8216
                    rotation = left
                    size = 64, 64
                ]

                port inv {
                    position = -32.0, 20.0
                    kind = pe
                }
                [
                    position = 8024, 8256
                    hide_name = True
                ]

                port Out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8504, 8144
                    rotation = down
                    hide_name = True
                ]

                port non_inv {
                    position = -32.0, -20.0
                    kind = pe
                }
                [
                    position = 8024, 8184
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8384
                ]

                junction Junction2 pe
                [
                    position = 8104, 8144
                ]

                junction Junction3 pe
                [
                    position = 8104, 8384
                ]

                junction Junction4 pe
                [
                    position = 8272, 8384
                ]

                connect Sw.p_node Ia1.p_node as Connection178
                connect V_VCC.p_node R_VCC.n_node as Connection181
                [
                    position = 0, 0
                    breakpoints = 7896, 8008; 8104, 8008
                ]
                connect gnd1.node Junction1 as Connection182
                connect Junction1 V_VCC.n_node as Connection183
                [
                    position = 0, 0
                    breakpoints = 8000, 8384; 7896, 8384
                ]
                connect R_VCC.p_node Junction2 as Connection185
                connect Junction2 Sw.n_node as Connection186
                connect R_OUT.n_node Junction2 as Connection187
                connect Ia1.n_node Junction3 as Connection188
                connect Junction3 Junction1 as Connection189
                connect Out H_VOUT.p_node as Connection191
                connect R_OUT.p_node Junction4 as Connection192
                connect Junction4 Junction3 as Connection193
                connect H_VOUT.n_node Junction4 as Connection194
                connect inv Sw.n_ctrl as Connection196
                connect non_inv Sw.p_ctrl as Connection197

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Comparator</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The comparator outputs the specified voltage magnitude. The polarity is determined by the sign of the diference between the non-inverting input and inverting input voltage values.</p></body></html>"

                    v_hi {
                        label = "High-state Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    v_lo {
                        label = "Low-state Voltage"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                    }

                    enable_hysteresis {
                        label = "Enable Hysteresis"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        group = "Hysteresis:2"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    vt_hi {
                        label = "High Threshold Voltage"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                        group = "Hysteresis"
                    }

                    vt_lo {
                        label = "Low Threshold Voltage"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "V"
                        group = "Hysteresis"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        enable_hyst = mdl.get_property_value(mdl.prop(item_handle, "enable_hysteresis"))
                        if enable_hyst:
                            mdl.set_component_icon_image(item_handle, 'images/comparator_hyst.svg')
                        else:
                            mdl.set_component_icon_image(item_handle, 'images/comparator.svg')
                    
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7424, 7968
                size = 64, 64
            ]

            component Subsystem "Pulse Width Modulator" {
                layout = static
                label = "PWM"
                component src_ground gnd1 {
                }
                [
                    position = 7920, 8336
                ]

                component "xyce_lib/Ideal Resistor" Rduty {
                    R = "1000"
                }
                [
                    position = 7920, 8200
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Pulse Voltage Source" "Pulse Voltage Source1" {
                    PER = "0"
                    PW = "0"
                    V1 = "0"
                }
                [
                    position = 8200, 8200
                    rotation = left
                    size = 64, 64
                ]

                component "xyce_lib/Pulse Voltage Source" "Pulse Voltage Source2" {
                    PER = "0"
                    PW = "0"
                    V1 = "0"
                }
                [
                    position = 8440, 8208
                    rotation = left
                    size = 64, 64
                ]

                port Out {
                    position = 32.0, -20.0
                    kind = pe
                }
                [
                    position = 8288, 8112
                    rotation = down
                ]

                port duty {
                    position = left center
                    kind = pe
                }
                [
                    position = 7824, 8112
                ]

                port "Comp Out" {
                    position = 32.0, 20.0
                    kind = pe
                }
                [
                    position = 8528, 8112
                    rotation = down
                ]

                junction Junction1 pe
                [
                    position = 7920, 8296
                ]

                junction Junction2 pe
                [
                    position = 8200, 8296
                ]

                connect duty Rduty.n_node as Connection170
                [
                    position = 0, 0
                    breakpoints = 7920, 8112; 7912, 8112
                ]
                connect gnd1.node Junction1 as Connection173
                connect Junction1 Rduty.p_node as Connection174
                connect Out "Pulse Voltage Source1.p_node" as Connection176
                connect "Comp Out" "Pulse Voltage Source2.p_node" as Connection181
                connect "Pulse Voltage Source1.n_node" Junction2 as Connection182
                connect Junction2 Junction1 as Connection183
                [
                    position = 0, 0
                    breakpoints = 8048, 8296
                ]
                connect "Pulse Voltage Source2.n_node" Junction2 as Connection184

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Pulse Width Modulator</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Outputs complementary square-shaped waveforms from 0 V minimum voltage to the chosen maximum value.<br></br><br></br>The dead-time value is a percentage of the ouput waveform\'s period.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>The duty-cycle input accepts a voltage from 0 V to 1 V.</p></body></html>"

                    vmax {
                        label = "Output High-Voltage"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "V"
                    }

                    freq {
                        label = "Frequency"
                        widget = edit
                        type = generic
                        default_value = "1000"
                    }

                    deadtime {
                        label = "Dead-time"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "%"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/pwm.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7712, 7968
                size = 64, 64
            ]

            component Subsystem "Model-based OpAmp" {
                layout = static
                label = "OpAmp"
                component el_short "Short Circuit" {
                }
                [
                    position = 7896, 8040
                    rotation = down
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7896, 8112
                    rotation = down
                ]

                component el_short "Short Circuit2" {
                }
                [
                    position = 7896, 8176
                    rotation = down
                ]

                component el_short "Short Circuit3" {
                }
                [
                    position = 7896, 8248
                    rotation = down
                ]

                port p_node {
                    label = "-"
                    position = -32.0, 20.0
                    kind = pe
                }
                [
                    position = 8000, 8040
                    rotation = down
                    hide_name = True
                ]

                port n_node {
                    label = "+"
                    position = -32.0, -20.0
                    kind = pe
                }
                [
                    position = 7776, 8040
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                port vcc+ {
                    label = "VCC+"
                    position = top center
                    kind = pe
                }
                [
                    position = 8000, 8112
                    rotation = down
                    hide_name = True
                ]

                port vcc- {
                    label = "VCC-"
                    position = bottom center
                    kind = pe
                }
                [
                    position = 8000, 8176
                    rotation = down
                    hide_name = True
                ]

                port out {
                    label = "Out"
                    position = right center
                    kind = pe
                }
                [
                    position = 8000, 8248
                    rotation = down
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 7816, 8040
                ]

                junction Junction2 pe
                [
                    position = 7816, 8112
                ]

                junction Junction3 pe
                [
                    position = 7816, 8176
                ]

                connect p_node "Short Circuit.p_node" as Connection1
                connect vcc+ "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                connect Junction1 n_node as Connection5
                connect vcc- "Short Circuit2.p_node" as Connection7
                connect out "Short Circuit3.p_node" as Connection8
                connect "Short Circuit1.n_node" Junction2 as Connection9
                connect Junction2 Junction1 as Connection10
                connect "Short Circuit2.n_node" Junction3 as Connection12
                connect Junction3 Junction2 as Connection13
                connect "Short Circuit3.n_node" Junction3 as Connection14

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Model-based OpAmp</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Requires the loading of library files. The loaded model must contain 5 terminals in the following order: non-inverting input -> inverting input -> VCC+ -> VCC- -> output.</p></body></html>"

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE
                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog

                        repeat_parse(mdl, item_handle)
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        from PyQt5.QtWidgets import QWidget, QFileDialog
                        import os, sys, csv, io, re, pathlib

                        from xyce_thcc_lib.extra.spice_syntax_conv import spice_to_xyce

                        def fix_spice_syntax(mdl, item_handle, file):
                            new_filepath = spice_to_xyce(file)
                            mdl.set_property_value(mdl.prop(item_handle, "model_path"), new_filepath)
                            return new_filepath
                    
                        class FileDialog(QWidget):
                            def __init__(self, mdl, item_handle):
                                super().__init__()
                                self.title = 'Choose Library File'
                                self.left = 10
                                self.top = 10
                                self.width = 640
                                self.height = 480
                                self.mdl = mdl
                                self.item_handle = item_handle
                                self.comp_handle = mdl.get_sub_level_handle(item_handle)
                    
                            def parse_file(self, mdl):
                                choose_file = QFileDialog()
                    
                                file, _ = choose_file.getOpenFileName(self, 'Choose Library File', '.', 'SPICE Library files (*.lib)')
                    
                                if file:
                                    self.parse_models(mdl, item_handle, file)
                                    return True
                                else:
                                    return False
                    
                            def parse_models(self, mdl, item_handle, file):
                                model_list = []
                                subcircuit_model_list = []
                                # 5-pin OpAmps
                                num_pins = 5
                                # Find subcircuit-based models
                                sub_based = re.compile(r"^\.SUBCKT\s+(\S+)\s+([ A-z0-9_]+)\s+(?:PARAMS)?",
                                                        flags = re.I)

                                fix_syntax = mdl.get_property_disp_value(mdl.prop(item_handle, "fix_syntax"))
                                if fix_syntax:
                                    file = fix_spice_syntax(mdl, item_handle, file)

                                with io.open(file) as lib:
                                    in_sub_flag = False
                                    for line in lib:
                                        if not in_sub_flag:
                                            # Nested IFs in order to reduce the number of RegExes
                                            sub_match = re.match(sub_based, line)
                                            if sub_match:
                                                if len(sub_match.group(2).split()) == num_pins:
                                                    model_name = sub_match.group(1)
                                                    subcircuit_model_list.append(model_name)
                                                in_sub_flag  = True
                                        else:
                                            # Detect end of the subcircuit and update flag
                                            if re.match(r".[Ee][Nn][Dd][Ss]", line):
                                                in_sub_flag = False
                    
                                    mdl.set_property_combo_values(mdl.prop(item_handle, "model_name"), subcircuit_model_list)
                                    mdl.set_property_value(mdl.prop(item_handle, "model_path"), file)
                                    mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), file)
                                    mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), file)
                    
                        def load_and_parse_file(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            return ex.parse_file(mdl)
                    
                        def repeat_parse(mdl, item_handle):
                            ex = FileDialog(mdl, item_handle)
                            filename = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                            try:
                                return ex.parse_models(mdl, item_handle, filename)
                            except FileNotFoundError:
                                mdl.info("Warning: " + mdl.get_fqn(item_handle).split(".")[0] + " model file not found!")
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/op_amp_mb.svg')
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7872, 7968
                size = 64, 64
            ]
        }
        [
            position = 8320, 8200
            size = 96, 104
        ]

        component Category Special {
            layout = dynamic
            component Subsystem "Dynamic SPICE component" {
                layout = dynamic
                label = "DynSPICE"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Dynamic SPICE component</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This component is able to load and identify subcircuits in a Xyce library file. The appropriate terminals are created automatically; the positions of the terminals, however, must be configured manually.<br></br><br></br>The selection of a new subcircuit must be confirmed to enable the configuration of the terminals.</p></body></html>"

                    fix_syntax {
                        label = "Attempt to fix SPICE syntax"
                        widget = checkbox
                        type = bool
                        default_value = "False"

                        CODE property_value_edited
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            mdl.set_property_disp_value(loaded_lib_prop, "Select a library file")
                        ENDCODE
                    }

                    library {
                        label = "SPICE library"
                        widget = button
                        type = string
                        default_value = "Choose File..."
                        no_evaluate

                        CODE button_clicked
                            mdl.refresh_icon(container_handle)
                            comp_script, _, _ = return_comp_script(mdl, container_handle)
                            comp_script.load_and_parse_file(mdl, container_handle)
                        ENDCODE
                    }

                    loaded_lib {
                        label = "Loaded library file"
                        widget = edit
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_edited
                            old_value = mdl.get_property_value(prop_handle)
                            mdl.set_property_value(prop_handle, old_value)
                        ENDCODE

                    }

                    model_path {
                        label = "Model file path"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    relative_model_path {
                        label = "Relative model file path"
                        widget = edit
                        type = string
                        default_value = ""
                        nonvisible
                        no_evaluate

                        CODE property_value_changed
                            import pathlib
                            model_path_prop = mdl.prop(container_handle, "model_path")
                            loaded_lib_prop = mdl.prop(container_handle, "loaded_lib")
                            if not new_value == "":
                                new_path = pathlib.Path(mdl.get_model_file_path()).parent.joinpath(new_value)
                                if new_path.is_file():
                                    mdl.set_property_value(model_path_prop, str(new_path))
                                    mdl.set_property_value(loaded_lib_prop, str(new_path))
                        ENDCODE
                    }

                    model_name {
                        label = "Model name"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        no_evaluate

                        CODE property_value_changed
                            comp_script, positions, models_pin_info = return_comp_script(mdl, container_handle)
                            comp_script.update_component(mdl, mdl.get_parent(mdl.get_parent(prop_handle)), positions, models_pin_info)
                            mdl.refresh_icon(mdl.get_parent(mdl.get_parent(prop_handle)))
                        ENDCODE
                    }

                    show_netlist {
                        label = "View the netlist of the selected model"
                        widget = button
                        type = string
                        default_value = "Netlist"
                        no_evaluate

                        CODE button_clicked
                            comp_script, _, _ = return_comp_script(mdl, container_handle)
                            comp_script.view_netlist(mdl, container_handle)
                        ENDCODE
                    }

                    configure_positions {
                        label = "Configure terminal positions"
                        widget = button
                        type = string
                        default_value = "Configure"
                        disabled
                        no_evaluate

                        CODE button_clicked
                            comp_script, _, _ = return_comp_script(mdl, container_handle)
                            comp_script.configuration_availability(mdl, mdl.get_parent(mdl.get_parent(prop_handle)))
                        ENDCODE
                    }

                    pin_positions {
                        label = "Pin positions"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    pin_idx {
                        label = "Pin indexes"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    pin_order {
                        label = "Pin order"
                        widget = combo
                        combo_values = "-"
                        type = string
                        default_value = "-"
                        nonvisible
                        no_evaluate
                    }

                    selected_model {
                        label = "Selected model"
                        widget = combo
                        combo_values = "None"
                        type = string
                        default_value = "None"
                        nonvisible
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        import importlib
                        import xyce_thcc_lib.component_scripts.comp_dynamic_spice as comp_script
                        importlib.reload(comp_script)

                        positions = []
                        models_pin_info = {}

                        def return_comp_script(mdl, item_handle):
                            return (comp_script, positions, models_pin_info)

                        comp_script, _, models_pin_info = return_comp_script(mdl, item_handle)

                        comp_script.parse_models_loadfile(mdl, item_handle, models_pin_info)
                    ENDCODE

                    CODE define_icon
                        import pathlib
                    
                        model_name_prop = mdl.prop(item_handle, "model_name")
                        model_name = mdl.get_property_value(model_name_prop)
                        model_path_prop = mdl.prop(item_handle, "model_path")
                        model_path = mdl.get_property_value(model_path_prop)
                        relative_path_prop = mdl.prop(item_handle, "relative_model_path")
                        relative_path = mdl.get_property_value(relative_path_prop)
                        if relative_path:
                            open_path = pathlib.Path(mdl.get_model_file_path()).parent.joinpath(relative_path)
                        else:
                            open_path = pathlib.Path(model_path)

                        if open_path.is_file():
                            if not model_name == "None":
                                 mdl.set_color(item_handle, "blue")
                                 mdl.disp_component_icon_text(item_handle, " " + model_name, relpos_x = 0.5, relpos_y = 0.5, size = 8)
                        else:
                            mdl.set_property_value(mdl.prop(item_handle, "loaded_lib"), "File not found")
                            mdl.set_property_disp_value(mdl.prop(item_handle, "loaded_lib"), "File not found")
                            mdl.set_color(item_handle, "red")
                            mdl.disp_component_icon_text(item_handle, "Model", relpos_x = 0.5, relpos_y = 0.5, size = 8)
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        library = mdl.get_property_value(mdl.prop(item_handle, "library"))
                        model_path = mdl.get_property_value(mdl.prop(item_handle, "model_path"))
                        model_name = mdl.get_property_value(mdl.prop(item_handle, "model_name"))
                        show_netlist = mdl.get_property_value(mdl.prop(item_handle, "show_netlist"))
                        configure_positions = mdl.get_property_value(mdl.prop(item_handle, "configure_positions"))
                        pin_positions = mdl.get_property_value(mdl.prop(item_handle, "pin_positions"))
                        pin_idx = mdl.get_property_value(mdl.prop(item_handle, "pin_idx"))
                        pin_order = mdl.get_property_value(mdl.prop(item_handle, "pin_order"))
                        selected_model = mdl.get_property_value(mdl.prop(item_handle, "selected_model"))
                        # HEADER STOP
                        import builtins
                    
                        try:
                            model_path_prop = mdl.prop(item_handle, "model_path")
                            model_path = mdl.get_property_value(model_path_prop)
                            builtins.open(model_path)
                        except:
                            model_name_prop = mdl.prop(item_handle, "model_name")
                            model_name = mdl.get_property_value(model_name_prop)
                            name = mdl.get_fqn(item_handle).split(".")[0]
                            mdl.refresh_icon(item_handle)
                            raise ValueError("\n\n" + name + " MODEL FILE NOT FOUND")
                    ENDCODE
                }
            }
            [
                position = 7960, 8320
                size = 168, 136
            ]

            component Subsystem NodeID {
                layout = static
                label = "V"
                component src_ground gnd1 {
                }
                [
                    position = 7848, 8096
                    rotation = left
                ]

                component el_open "Open Circuit1" {
                    circuit_connector = "true"
                }
                [
                    position = 7760, 8096
                    rotation = down
                ]

                port node {
                    position = top center
                    kind = pe
                }
                [
                    position = 7680, 8096
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect gnd1.node "Open Circuit1.p_node" as Connection1
                connect "Open Circuit1.n_node" node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Identify the wire/node in the circuit.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>Nodes with the same name become connected.</p></body></html>"

                    node_id {
                        label = "Node Identifier"
                        widget = edit
                        type = generic
                        default_value = "names"
                        no_evaluate

                        CODE property_value_changed
                            mdl.refresh_icon(container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/node_id_test.svg')
                    
                        node_id = mdl.get_property_value(mdl.prop(item_handle, "node_id"))
                        mdl.set_color(item_handle, "green")
                    
                        mdl.disp_component_icon_text(item_handle, node_id, relpos_x = 0.5, relpos_y = 0.85, size = 6)
                    ENDCODE
                }
            }
            [
                position = 7824, 8336
                hide_name = True
                size = 32, 32
            ]
        }
        [
            position = 7872, 8208
            size = 96, 104
        ]

        component Category "Behavioral Digital" {
            layout = dynamic
            component Subsystem Delay_ {
                layout = dynamic
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                port in {
                    position = left:auto
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port out {
                    position = right:auto
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" out as Connection2
                connect in "Short Circuit.p_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Time delay</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "1e-5"
                        unit = "s"
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "S0VHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "S1VLO"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        nonvisible
                        no_evaluate
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "BUF"
                        type = string
                        default_value = "BUF"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "output_voltage"
                        widget = edit
                        type = generic
                        default_value = "1"
                        nonvisible
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7784, 8224
                size = 64, 64
            ]

            component Subsystem NOT {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                port in {
                    position = left center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" out as Connection2
                connect in "Short Circuit.p_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">NOT logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "INV"
                        type = string
                        default_value = "INV"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_inverter.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7944, 8072
                size = 64, 64
            ]

            component Subsystem AND {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">AND logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "AND"
                        type = string
                        default_value = "AND"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_and.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7944, 8176
                size = 64, 64
            ]

            component Subsystem NAND {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">NAND logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "NAND"
                        type = string
                        default_value = "NAND"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_nand.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 8056, 8176
                size = 64, 64
            ]

            component Subsystem OR {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">OR logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "OR"
                        type = string
                        default_value = "OR"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_or.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7944, 8272
                size = 64, 64
            ]

            component Subsystem NOR {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">NOR logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "NOR"
                        type = string
                        default_value = "NOR"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_nor.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 8056, 8272
                size = 64, 64
            ]

            component Subsystem XOR {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">XOR logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "XOR"
                        type = string
                        default_value = "XOR"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_xor.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 7944, 8368
                size = 64, 64
            ]

            component Subsystem XNOR {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7912, 7992
                ]

                component el_short "Short Circuit1" {
                }
                [
                    position = 7912, 8112
                ]

                port in1 {
                    position = -32.0, -16.0
                    kind = pe
                }
                [
                    position = 7776, 7992
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8080, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                port in2 {
                    position = -32.0, 16.0
                    kind = pe
                }
                [
                    position = 7776, 8112
                    hide_name = True
                ]

                junction Junction1 pe
                [
                    position = 8000, 8056
                ]

                connect in1 "Short Circuit.p_node" as Connection1
                connect in2 "Short Circuit1.p_node" as Connection3
                connect "Short Circuit.n_node" Junction1 as Connection4
                [
                    position = 0, 0
                    breakpoints = 8000, 7992
                ]
                connect Junction1 out as Connection5
                [
                    position = 0, 0
                    breakpoints = 8000, 8064
                ]
                connect "Short Circuit1.n_node" Junction1 as Connection6

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">XNOR logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "NXOR"
                        type = string
                        default_value = "NXOR"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_xnor.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 8056, 8368
                size = 64, 64
            ]

            component Subsystem BUFFER {
                layout = static
                component el_short "Short Circuit" {
                }
                [
                    position = 7904, 8064
                ]

                port in {
                    position = left center
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port out {
                    position = right center
                    kind = pe
                }
                [
                    position = 8040, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                connect "Short Circuit.n_node" out as Connection2
                connect in "Short Circuit.p_node" as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">BUFFER logic</p></body></html>"

                    CHI {
                        label = "CHI"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLO {
                        label = "CLO"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    CLOAD {
                        label = "CLOAD"
                        widget = edit
                        type = generic
                        default_value = "0"
                        nonvisible
                        no_evaluate
                    }

                    DELAY {
                        label = "Delay"
                        widget = edit
                        type = generic
                        default_value = "0"
                        unit = "s"
                        nonvisible
                        no_evaluate
                    }

                    RLOAD {
                        label = "RLOAD"
                        widget = edit
                        type = generic
                        default_value = "1e4"
                        nonvisible
                        no_evaluate
                    }

                    S0RHI {
                        label = "S0RHI"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S0RLO {
                        label = "S0RLO"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S0TSW {
                        label = "S0TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S0VHI {
                        label = "Maximum low-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = "V"
                    }

                    S0VLO {
                        label = "S0VLO"
                        widget = edit
                        type = generic
                        default_value = "-100"
                        nonvisible
                        no_evaluate
                    }

                    S1RHI {
                        label = "S1RHI"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        nonvisible
                        no_evaluate
                    }

                    S1RLO {
                        label = "S1RLO"
                        widget = edit
                        type = generic
                        default_value = "1000"
                        nonvisible
                        no_evaluate
                    }

                    S1TSW {
                        label = "S1TSW"
                        widget = edit
                        type = generic
                        default_value = "{GLOBAL_TS*1e-4}"
                        nonvisible
                        no_evaluate
                    }

                    S1VHI {
                        label = "S1VHI"
                        widget = edit
                        type = generic
                        default_value = "100"
                        nonvisible
                        no_evaluate
                    }

                    S1VLO {
                        label = "Minimum high-state input voltage"
                        widget = edit
                        type = generic
                        default_value = "0.9"
                        unit = "V"
                    }

                    type {
                        label = "type"
                        widget = combo
                        combo_values = "BUF"
                        type = string
                        default_value = "BUF"
                        nonvisible
                        no_evaluate
                    }

                    output_voltage {
                        label = "Output Voltage"
                        widget = edit
                        type = generic
                        default_value = "3.3"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/behavioral_buffer.svg')
                    ENDCODE

                    CODE init
                    ENDCODE
                }
            }
            [
                position = 8056, 8080
                size = 64, 64
            ]
        }
        [
            position = 7872, 8400
            size = 96, 96
        ]

        component Category Measurements {
            layout = dynamic
            component Subsystem "Power Measurement" {
                layout = static
                label = "P"
                component "core/Current Measurement" I {
                }
                [
                    position = 7864, 8064
                    size = 64, 32
                ]

                component "core/Voltage Measurement" V {
                }
                [
                    position = 7968, 8136
                    rotation = right
                    size = 64, 32
                ]

                port in_p {
                    position = left top
                    kind = pe
                }
                [
                    position = 7768, 8064
                    hide_name = True
                ]

                port out_p {
                    position = right top
                    kind = pe
                }
                [
                    position = 8048, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                port in_n {
                    position = left bottom
                    kind = pe
                }
                [
                    position = 7768, 8200
                    hide_name = True
                ]

                port out_n {
                    position = right bottom
                    kind = pe
                }
                [
                    position = 8048, 8200
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 pe
                [
                    position = 7968, 8064
                ]

                junction Junction2 pe
                [
                    position = 7968, 8200
                ]

                connect in_p I.p_node as Connection1
                connect V.p_node Junction1 as Connection3
                connect Junction1 I.n_node as Connection4
                connect out_p Junction1 as Connection5
                connect in_n Junction2 as Connection7
                connect Junction2 out_n as Connection8
                connect V.n_node Junction2 as Connection9

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power Measurement</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/msr_power.svg')
                    ENDCODE
                }
            }
            [
                position = 7616, 7936
                size = 96, 96
            ]

            component Subsystem "Node Voltage" {
                layout = static
                label = "V"
                component src_ground gnd1 {
                }
                [
                    position = 7792, 8072
                    rotation = left
                ]

                component el_open "Open Circuit1" {
                    circuit_connector = "true"
                }
                [
                    position = 7704, 8072
                    rotation = down
                ]

                port node {
                    position = left center
                    kind = pe
                }
                [
                    position = 7624, 8072
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                ]

                connect gnd1.node "Open Circuit1.p_node" as Connection1
                connect "Open Circuit1.n_node" node as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Measures the node-to-ground voltage.</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        def empty():
                            pass
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/msr_node_voltage.svg')
                    ENDCODE
                }
            }
            [
                position = 7184, 7904
                size = 32, 32
            ]

            component Subsystem Probe {
                layout = static
                label = "Probe"
                component gen_probe Probe1 {
                }
                [
                    position = 8192, 8192
                ]

                port In {
                    position = left center
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                    hide_name = True
                ]

                connect Probe1.in In as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/probe.svg')
                    ENDCODE
                }
            }
            [
                position = 7184, 8016
                size = 32, 32
            ]

            component Subsystem "Current Measurement" {
                layout = static
                label = "I"
                component "core/Current Measurement" I {
                    execution_rate = "1"
                    sig_output = "True"
                }
                [
                    position = 8192, 8192
                    size = 64, 32
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 8272, 8192
                    rotation = down
                    hide_name = True
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 8112, 8192
                    hide_name = True
                ]

                connect I.p_node p_node as Connection2
                connect I.n_node n_node as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Voltage Measurement</p></body></html>"

                    signal_out {
                        label = "Signal output"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_changed
                            show_signal_output(mdl, container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        x0, y0 = (8192, 8192)
                    
                        def delete_port(mdl, name, parent):
                            comp = mdl.get_item(name, parent=parent, item_type="port")
                            if comp:
                                mdl.delete_item(comp)
                    
                        def show_signal_output(mdl, mask_handle):
                            comp_handle = mdl.get_parent(mask_handle)
                            signal_out = mdl.get_property_value(mdl.prop(item_handle, "signal_out"))
                    
                            inner_measure_handle = mdl.get_item("I", parent=comp_handle)
                            inner_sig_output_prop = mdl.prop(inner_measure_handle, "sig_output")

                            if signal_out:
                                mdl.set_property_value(inner_sig_output_prop, True)
                                out_port = mdl.create_port(
                                name="signal_out",
                                parent=comp_handle,
                                hide_name=True,
                                rotation='left',
                                kind='sp',
                                direction='out',
                                position=(x0, y0-100),
                                terminal_position=("top","center")
                                )
                                mdl.create_connection(mdl.term(inner_measure_handle, "out"), out_port)
                            else:
                                delete_port(mdl, "signal_out", parent=comp_handle)
                                mdl.set_property_value(inner_sig_output_prop, False)
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/msr_current.svg')
                    ENDCODE
                }
            }
            [
                position = 7304, 7904
                size = 64, 32
            ]

            component Subsystem "Voltage Measurement" {
                layout = static
                label = "Vm"
                component "core/Voltage Measurement" V {
                    execution_rate = "1"
                    sig_output = "True"
                }
                [
                    position = 8192, 8192
                    size = 64, 32
                ]

                port p_node {
                    position = left center
                    kind = pe
                }
                [
                    position = 8112, 8192
                    hide_name = True
                ]

                port n_node {
                    position = right center
                    kind = pe
                }
                [
                    position = 8272, 8192
                    rotation = down
                    hide_name = True
                ]

                connect V.n_node n_node as Connection2
                connect V.p_node p_node as Connection1

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Voltage Measurement</p></body></html>"

                    signal_out {
                        label = "Signal output"
                        widget = checkbox
                        type = bool
                        default_value = "False"
                        no_evaluate

                        CODE property_value_changed
                            show_signal_output(mdl, container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        x0, y0 = (8192, 8192)
                    
                        def delete_port(mdl, name, parent):
                            comp = mdl.get_item(name, parent=parent, item_type="port")
                            if comp:
                                mdl.delete_item(comp)
                    
                        def show_signal_output(mdl, mask_handle):
                            comp_handle = mdl.get_parent(mask_handle)
                            signal_out = mdl.get_property_value(mdl.prop(item_handle, "signal_out"))
                    
                            inner_measure_handle = mdl.get_item("V", parent=comp_handle)
                            inner_sig_output_prop = mdl.prop(inner_measure_handle, "sig_output")
                    
                            if signal_out:
                                mdl.set_property_value(inner_sig_output_prop, True)
                                out_port = mdl.create_port(
                                name="signal_out",
                                parent=comp_handle,
                                hide_name=True,
                                rotation='left',
                                kind='sp',
                                direction='out',
                                position=(x0, y0-100),
                                terminal_position=("top","center")
                                )
                                mdl.create_connection(mdl.term(inner_measure_handle, "out"), out_port)
                            else:
                                delete_port(mdl, "signal_out", parent=comp_handle)
                                mdl.set_property_value(inner_sig_output_prop, False)
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/msr_voltage.svg')
                    ENDCODE
                }
            }
            [
                position = 7456, 7904
                size = 64, 32
            ]

            component Subsystem Signal-to-Power {
                layout = dynamic
                label = "Sig2Pwr"
                component "core/Signal Controlled Voltage Source" Vsp1 {
                }
                [
                    position = 8208, 8192
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                port In {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8128, 8192
                ]

                port p_node {
                    position = right:1
                    kind = pe
                }
                [
                    position = 8256, 8120
                    rotation = down
                ]

                port n_node {
                    position = right:2
                    kind = pe
                }
                [
                    position = 8208, 8264
                    rotation = left
                ]

                connect In Vsp1.in as Connection1
                connect n_node Vsp1.n_node as Connection2
                connect p_node Vsp1.p_node as Connection3
            }
            [
                position = 7304, 8008
                size = 48, 48
            ]

            component Subsystem Scope {
                layout = static

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    CODE open

                        comp_script = return_comp_script(mdl, item_handle)
                        comp_script.initialize_scope(mdl, item_handle)

                    ENDCODE

                    CODE init

                        import importlib
                        import xyce_thcc_lib.component_scripts.comp_scope as comp_script
                        importlib.reload(comp_script)

                        def return_comp_script(mdl, item_handle):
                            return comp_script

                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'images/scope.svg')
                    ENDCODE
                }
            }
            [
                position = 7616, 8144
                size = 104, 112
            ]
        }
        [
            position = 8096, 8400
            size = 96, 104
        ]

        component Category Math {
            layout = dynamic
            component Subsystem "Absolute Value" {
                layout = dynamic
                label = "Abs"
                component gen_abs Abs1 {
                    execution_rate = "1"
                }
                [
                    position = 7760, 8040
                ]

                port In {
                    position = auto:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7672, 8040
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7840, 8040
                ]

                connect Abs1.out Out as Connection1
                connect Abs1.in In as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output is the absolute value of the input.<br></br><br></br>In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE
                }
            }
            [
                position = 7424, 8032
                size = 48, 48
            ]

            component Subsystem Gain {
                layout = dynamic
                label = "Gain"
                component gen_gain G {
                    gain = "gain"
                }
                [
                    position = 7656, 7976
                ]

                port In {
                    position = auto:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7568, 7976
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7736, 7976
                ]

                connect In G.in as Connection1
                connect G.out Out as Connection2

                gain = "1"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                    gain {
                        label = "Gain"
                        widget = edit
                        type = generic
                        default_value = "0"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE
                }
            }
            [
                position = 7536, 7952
                size = 48, 48
            ]

            component Subsystem Saturation {
                layout = dynamic
                label = "Sat"
                component gen_limiter Limit1 {
                    lower_limit = "min"
                    upper_limit = "max"
                }
                [
                    position = 7584, 7968
                ]

                port In {
                    position = auto:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7504, 7968
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7672, 7968
                ]

                connect Limit1.out Out as Connection1
                connect Limit1.in In as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output is equal to the input limited to the minimum and maximum values entered.<br></br><br></br>In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    max {
                        label = "Maximum"
                        widget = edit
                        type = generic
                        default_value = "1"
                        unit = "V"
                    }

                    min {
                        label = "Minimum"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        unit = "V"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE
                }
            }
            [
                position = 7536, 8032
                size = 48, 48
            ]

            component Subsystem "Trig Function" {
                layout = dynamic
                label = "TrigFcn"
                component gen_gain G {
                }
                [
                    position = 7880, 8048
                ]

                port In {
                    position = auto:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7792, 8048
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7960, 8048
                ]

                connect In G.in as Connection1
                connect G.out Out as Connection2

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output is the selected trigonometric function applied to the input value.<br></br><br></br>Values are in degrees.<br></br><br></br>In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    trig_fcn {
                        label = "Function"
                        widget = combo
                        combo_values = "sin", "cos", "tan", "asin", "acos", "atan"
                        type = string
                        default_value = "sin"
                        no_evaluate
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE
                }
            }
            [
                position = 7424, 8112
                size = 48, 48
            ]

            component Subsystem Sum {
                layout = dynamic
                label = "Sum"
                component gen_sum Sum1 {
                    execution_rate = "1"
                    signs = "++"
                }
                [
                    position = 8256, 8192
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8336, 8192
                ]

                port In1 {
                    label = "+"
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8096
                ]

                port In2 {
                    label = "+"
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8144
                ]

                connect Sum1.out Out as Connection1
                connect Sum1.in In1 as Connection2
                connect Sum1.in1 In2 as Connection3

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output is the sum of the inputs multiplied by the entered signs.<br></br><br></br>Characters other than + or - will be ignored.<br></br><br></br>The maximum number of inputs is 5.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    signs {
                        label = "Signs"
                        widget = edit
                        type = generic
                        default_value = "++"
                        no_evaluate

                        CODE property_value_changed
                            update_inputs(mdl, container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        x0, y0 = (8192, 8192)
                    
                        def delete_port(mdl, name, parent):
                            comp = mdl.get_item(name, parent=parent, item_type="port")
                            if comp:
                                mdl.delete_item(comp)
                    
                        def update_inputs(mdl, mask_handle):
                            comp_handle = mdl.get_parent(mask_handle)
                            signs_prop = mdl.prop(mask_handle, "signs")
                            signs = mdl.get_property_value(signs_prop)
                    
                            sum_handle = mdl.get_item("Sum1", parent=comp_handle)
                    
                            for c in signs:
                                if not c in ["+", "-"]:
                                    signs = signs.replace(c, "")
                            signs = signs[:5]
                    
                            mdl.set_property_value(mdl.prop(sum_handle, "signs"), signs)
                    
                            for idx in range(1, 6):
                                delete_port(mdl, "In"+str(idx), parent=comp_handle)
                    
                            for idx in range(len(signs)):
                    
                                if idx == 0:
                                    sum_input_name = "in"
                                else:
                                    sum_input_name = "in"+str(idx)
                    
                                new_input = mdl.create_port(
                                name="In"+str(idx+1),
                                label = signs[idx],
                                parent=comp_handle,
                                rotation='up',
                                kind='sp',
                                direction='in',
                                position=(x0-50, y0-100 + 50*idx)
                                #terminal_position=(-24, 48*(num_windings-1))
                                )
                                mdl.create_connection(mdl.term(sum_handle, sum_input_name), new_input)
                    ENDCODE
                }
            }
            [
                position = 7640, 7968
                size = 48, 80
            ]

            component Subsystem Product_ {
                layout = dynamic
                label = "Product"
                component gen_product Product1 {
                    execution_rate = "1"
                    signs = "**"
                }
                [
                    position = 8320, 8192
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8408, 8192
                ]

                port In1 {
                    label = "*"
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8096
                ]

                port In2 {
                    label = "*"
                    position = left:auto
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8144, 8144
                ]

                connect Product1.out Out as Connection1
                connect Product1.in In1 as Connection2
                connect Product1.in1 In2 as Connection3

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The output is the multiplication or division of the inputs, depending on the entered operations.<br></br><br></br>Characters other than * or / will be ignored.<br></br><br></br>The maximum number of inputs is 5.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br>In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    operations {
                        label = "Operations"
                        widget = edit
                        type = generic
                        default_value = "**"
                        no_evaluate

                        CODE property_value_changed
                            update_inputs(mdl, container_handle)
                        ENDCODE
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE

                    CODE init
                        x0, y0 = (8192, 8192)
                    
                        def delete_port(mdl, name, parent):
                            comp = mdl.get_item(name, parent=parent, item_type="port")
                            if comp:
                                mdl.delete_item(comp)
                    
                        def update_inputs(mdl, mask_handle):
                            comp_handle = mdl.get_parent(mask_handle)
                            operations_prop = mdl.prop(mask_handle, "operations")
                            operations = mdl.get_property_value(operations_prop)
                    
                            product_handle = mdl.get_item("Product1", parent=comp_handle)
                    
                            for c in operations:
                                if not c in ["*", "/"]:
                                    operations = operations.replace(c, "")
                            operations = operations[:5]
                    
                            mdl.set_property_value(mdl.prop(product_handle, "signs"), operations)
                    
                            for idx in range(1, 6):
                                delete_port(mdl, "In"+str(idx), parent=comp_handle)
                    
                            for idx in range(len(operations)):
                    
                                if idx == 0:
                                    prod_input_name = "in"
                                else:
                                    prod_input_name = "in"+str(idx)
                    
                                new_input = mdl.create_port(
                                name="In"+str(idx+1),
                                label = operations[idx],
                                parent=comp_handle,
                                rotation='up',
                                kind='sp',
                                direction='in',
                                position=(x0-50, y0-100 + 50*idx)
                                #terminal_position=(-24, 48*(num_windings-1))
                                )
                                mdl.create_connection(mdl.term(product_handle, prod_input_name), new_input)
                    ENDCODE
                }
            }
            [
                position = 7640, 8088
                size = 48, 80
            ]

            component Subsystem Constant {
                layout = dynamic
                label = "Constant"
                component src_constant Constant1 {
                    execution_rate = "1"
                    value = "value"
                }
                [
                    position = 7768, 8040
                ]

                port Out {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7840, 8040
                ]

                connect Constant1.out Out as Connection1

                value = "1"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">In the Schematic Editor this component is of the signal processing type. In Xyce, however, it is an electrical source.</p></body></html>"

                    value {
                        label = "Value"
                        widget = edit
                        type = generic
                        default_value = "0"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                    
                    ENDCODE
                }
            }
            [
                position = 7424, 7952
                size = 48, 48
            ]
        }
        [
            position = 8320, 8400
            size = 96, 104
        ]
    }

    default {
    }
}
